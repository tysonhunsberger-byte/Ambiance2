typeof BigInt>"u"&&(BigInt=function(t){if(isNaN(t))throw new Error("");return t});const g=BigInt(0),b=BigInt(1),yt=BigInt(2),jt=BigInt(5),J=BigInt(10),ha=2e3,w={s:b,n:g,d:b};function Z(t,e){try{t=BigInt(t)}catch{throw et()}return t*e}function U(t){return typeof t=="bigint"?t:Math.floor(t)}function T(t,e){if(e===g)throw Ht();const n=Object.create(S.prototype);n.s=t<g?-b:b,t=t<g?-t:t;const s=ot(t,e);return n.n=t/s,n.d=e/s,n}function ct(t){const e={};let n=t,s=yt,r=jt-b;for(;r<=n;){for(;n%s===g;)n/=s,e[s]=(e[s]||g)+b;r+=b+yt*s++}return n!==t?n>1&&(e[n]=(e[n]||g)+b):e[t]=(e[t]||g)+b,e}const M=function(t,e){let n=g,s=b,r=b;if(t!=null)if(e!==void 0){if(typeof t=="bigint")n=t;else{if(isNaN(t))throw et();if(t%1!==0)throw ke();n=BigInt(t)}if(typeof e=="bigint")s=e;else{if(isNaN(e))throw et();if(e%1!==0)throw ke();s=BigInt(e)}r=n*s}else if(typeof t=="object"){if("d"in t&&"n"in t)n=BigInt(t.n),s=BigInt(t.d),"s"in t&&(n*=BigInt(t.s));else if(0 in t)n=BigInt(t[0]),1 in t&&(s=BigInt(t[1]));else if(typeof t=="bigint")n=t;else throw et();r=n*s}else if(typeof t=="number"){if(isNaN(t))throw et();if(t<0&&(r=-b,t=-t),t%1===0)n=BigInt(t);else if(t>0){let o=1,i=0,u=1,a=1,l=1,h=1e7;for(t>=1&&(o=10**Math.floor(1+Math.log10(t)),t/=o);u<=h&&l<=h;){let p=(i+a)/(u+l);if(t===p){u+l<=h?(n=i+a,s=u+l):l>u?(n=a,s=l):(n=i,s=u);break}else t>p?(i+=a,u+=l):(a+=i,l+=u),u>h?(n=a,s=l):(n=i,s=u)}n=BigInt(n)*BigInt(o),s=BigInt(s)}}else if(typeof t=="string"){let o=0,i=g,u=g,a=g,l=b,h=b,p=t.replace(/_/g,"").match(/\d+|./g);if(p===null)throw et();if(p[o]==="-"?(r=-b,o++):p[o]==="+"&&o++,p.length===o+1?u=Z(p[o++],r):p[o+1]==="."||p[o]==="."?(p[o]!=="."&&(i=Z(p[o++],r)),o++,(o+1===p.length||p[o+1]==="("&&p[o+3]===")"||p[o+1]==="'"&&p[o+3]==="'")&&(u=Z(p[o],r),l=J**BigInt(p[o].length),o++),(p[o]==="("&&p[o+2]===")"||p[o]==="'"&&p[o+2]==="'")&&(a=Z(p[o+1],r),h=J**BigInt(p[o+1].length)-b,o+=3)):p[o+1]==="/"||p[o+1]===":"?(u=Z(p[o],r),l=Z(p[o+2],b),o+=3):p[o+3]==="/"&&p[o+1]===" "&&(i=Z(p[o],r),u=Z(p[o+2],r),l=Z(p[o+4],b),o+=5),p.length<=o)s=l*h,r=n=a+s*i+h*u;else throw et()}else if(typeof t=="bigint")n=t,r=t,s=b;else throw et();if(s===g)throw Ht();w.s=r<g?-b:b,w.n=n<g?-n:n,w.d=s<g?-s:s};function da(t,e,n){let s=b;for(;e>g;t=t*t%n,e>>=b)e&b&&(s=s*t%n);return s}function ma(t,e){for(;e%yt===g;e/=yt);for(;e%jt===g;e/=jt);if(e===b)return g;let n=J%e,s=1;for(;n!==b;s++)if(n=n*J%e,s>ha)return g;return BigInt(s)}function ya(t,e,n){let s=b,r=da(J,n,e);for(let o=0;o<300;o++){if(s===r)return BigInt(o);s=s*J%e,r=r*J%e}return 0}function ot(t,e){if(!t)return e;if(!e)return t;for(;;){if(t%=e,!t)return e;if(e%=t,!e)return t}}function S(t,e){if(M(t,e),this instanceof S)t=ot(w.d,w.n),this.s=w.s,this.n=w.n/t,this.d=w.d/t;else return T(w.s*w.n,w.d)}var Ht=function(){return new Error("Division by Zero")},et=function(){return new Error("Invalid argument")},ke=function(){return new Error("Parameters must be integer")};S.prototype={s:b,n:g,d:b,abs:function(){return T(this.n,this.d)},neg:function(){return T(-this.s*this.n,this.d)},add:function(t,e){return M(t,e),T(this.s*this.n*w.d+w.s*this.d*w.n,this.d*w.d)},sub:function(t,e){return M(t,e),T(this.s*this.n*w.d-w.s*this.d*w.n,this.d*w.d)},mul:function(t,e){return M(t,e),T(this.s*w.s*this.n*w.n,this.d*w.d)},div:function(t,e){return M(t,e),T(this.s*w.s*this.n*w.d,this.d*w.n)},clone:function(){return T(this.s*this.n,this.d)},mod:function(t,e){if(t===void 0)return T(this.s*this.n%this.d,b);if(M(t,e),g===w.n*this.d)throw Ht();return T(this.s*(w.d*this.n)%(w.n*this.d),w.d*this.d)},gcd:function(t,e){return M(t,e),T(ot(w.n,this.n)*ot(w.d,this.d),w.d*this.d)},lcm:function(t,e){return M(t,e),w.n===g&&this.n===g?T(g,b):T(w.n*this.n,ot(w.n,this.n)*ot(w.d,this.d))},inverse:function(){return T(this.s*this.d,this.n)},pow:function(t,e){if(M(t,e),w.d===b)return w.s<g?T((this.s*this.d)**w.n,this.n**w.n):T((this.s*this.n)**w.n,this.d**w.n);if(this.s<g)return null;let n=ct(this.n),s=ct(this.d),r=b,o=b;for(let i in n)if(i!=="1"){if(i==="0"){r=g;break}if(n[i]*=w.n,n[i]%w.d===g)n[i]/=w.d;else return null;r*=BigInt(i)**n[i]}for(let i in s)if(i!=="1"){if(s[i]*=w.n,s[i]%w.d===g)s[i]/=w.d;else return null;o*=BigInt(i)**s[i]}return w.s<g?T(o,r):T(r,o)},log:function(t,e){if(M(t,e),this.s<=g||w.s<=g)return null;const n={},s=ct(w.n),r=ct(w.d),o=ct(this.n),i=ct(this.d);for(const l in r)s[l]=(s[l]||g)-r[l];for(const l in i)o[l]=(o[l]||g)-i[l];for(const l in s)l!=="1"&&(n[l]=!0);for(const l in o)l!=="1"&&(n[l]=!0);let u=null,a=null;for(const l in n){const h=s[l]||g,p=o[l]||g;if(h===g){if(p!==g)return null;continue}let k=p,_=h;const A=ot(k,_);if(k/=A,_/=A,u===null&&a===null)u=k,a=_;else if(k*a!==u*_)return null}return u!==null&&a!==null?T(u,a):null},equals:function(t,e){return M(t,e),this.s*this.n*w.d===w.s*w.n*this.d},lt:function(t,e){return M(t,e),this.s*this.n*w.d<w.s*w.n*this.d},lte:function(t,e){return M(t,e),this.s*this.n*w.d<=w.s*w.n*this.d},gt:function(t,e){return M(t,e),this.s*this.n*w.d>w.s*w.n*this.d},gte:function(t,e){return M(t,e),this.s*this.n*w.d>=w.s*w.n*this.d},compare:function(t,e){M(t,e);let n=this.s*this.n*w.d-w.s*w.n*this.d;return(g<n)-(n<g)},ceil:function(t){return t=J**BigInt(t||0),T(U(this.s*t*this.n/this.d)+(t*this.n%this.d>g&&this.s>=g?b:g),t)},floor:function(t){return t=J**BigInt(t||0),T(U(this.s*t*this.n/this.d)-(t*this.n%this.d>g&&this.s<g?b:g),t)},round:function(t){return t=J**BigInt(t||0),T(U(this.s*t*this.n/this.d)+this.s*((this.s>=g?b:g)+yt*(t*this.n%this.d)>this.d?b:g),t)},roundTo:function(t,e){M(t,e);const n=this.n*w.d,s=this.d*w.n,r=n%s;let o=U(n/s);return r+r>=s&&o++,T(this.s*o*w.n,w.d)},divisible:function(t,e){return M(t,e),!(!(w.n*this.d)||this.n*w.d%(w.n*this.d))},valueOf:function(){return Number(this.s*this.n)/Number(this.d)},toString:function(t){let e=this.n,n=this.d;t=t||15;let s=ma(e,n),r=ya(e,n,s),o=this.s<g?"-":"";if(o+=U(e/n),e%=n,e*=J,e&&(o+="."),s){for(let i=r;i--;)o+=U(e/n),e%=n,e*=J;o+="(";for(let i=s;i--;)o+=U(e/n),e%=n,e*=J;o+=")"}else for(let i=t;e&&i--;)o+=U(e/n),e%=n,e*=J;return o},toFraction:function(t){let e=this.n,n=this.d,s=this.s<g?"-":"";if(n===b)s+=e;else{let r=U(e/n);t&&r>g&&(s+=r,s+=" ",e%=n),s+=e,s+="/",s+=n}return s},toLatex:function(t){let e=this.n,n=this.d,s=this.s<g?"-":"";if(n===b)s+=e;else{let r=U(e/n);t&&r>g&&(s+=r,e%=n),s+="\\frac{",s+=e,s+="}{",s+=n,s+="}"}return s},toContinued:function(){let t=this.n,e=this.d,n=[];do{n.push(U(t/e));let s=t%e;t=e,e=s}while(t!==b);return n},simplify:function(t){const e=BigInt(1/(t||.001)|0),n=this.abs(),s=n.toContinued();for(let r=1;r<s.length;r++){let o=T(s[r-1],b);for(let u=r-2;u>=0;u--)o=o.inverse().add(s[u]);let i=o.sub(n);if(i.n*e<i.d)return o.mul(this.s)}return this}};const Vt="strudel.log";let wa=1e3,qe,Ae;function Gt(t,e="cyclist"){j(`[${e}] error: ${t.message}`)}function j(t,e,n={}){let s=performance.now();qe===t&&s-Ae<wa||(qe=t,Ae=s,console.log(`%c${t}`,"background-color: black;color:white;border-radius:15px"),typeof document<"u"&&typeof CustomEvent<"u"&&document.dispatchEvent(new CustomEvent(Vt,{detail:{message:t,type:e,data:n}})))}j.key=Vt;const ga=t=>/^[a-gA-G][#bs]*[0-9]$/.test(t),Tt=t=>/^[a-gA-G][#bsf]*-?[0-9]?$/.test(t),Te=t=>{if(typeof t!="string")return[];const[e,n="",s]=t.match(/^([a-gA-G])([#bsf]*)(-?[0-9]*)$/)?.slice(1)||[];return e?[e,n,s?Number(s):void 0]:[]},ba={c:0,d:2,e:4,f:5,g:7,a:9,b:11},_a={"#":1,b:-1,s:1,f:-1},_t=(t,e=3)=>{const[n,s,r=e]=Te(t);if(!n)throw new Error('not a note: "'+t+'"');const o=ba[n.toLowerCase()],i=s?.split("").reduce((u,a)=>u+_a[a],0)||0;return(Number(r)+1)*12+o+i},at=t=>Math.pow(2,(t-69)/12)*440,Ce=t=>12*Math.log(t/440)/Math.LN2+69,va=(t,e)=>{if(typeof t!="object")throw new Error("valueToMidi: expected object value");let{freq:n,note:s}=t;if(typeof n=="number")return Ce(n);if(typeof s=="string")return _t(s);if(typeof s=="number")return s;if(!e)throw new Error("valueToMidi: expected freq or note to be set");return e},ka=(t,e)=>(t-e)*1e3,xe=t=>at(typeof t=="number"?t:_t(t)),qa=["C","Db","D","Eb","E","F","Gb","G","Ab","A","Bb","B"],Aa=t=>{const e=Math.floor(t/12)-1;return qa[t%12]+e},vt=(t,e)=>(t%e+e)%e,Oe=t=>t.reduce((e,n)=>e+n)/t.length;function ze(t,e=0){return isNaN(Number(t))?(j(`"${t}" is not a number, falling back to ${e}`,"warning"),e):t}const Sa=(t,e)=>vt(Math.round(ze(t??0,0)),e),Ba=t=>{let{value:e,context:n}=t,s=e;if(typeof s=="object"&&!Array.isArray(s)&&(s=s.note||s.n||s.value,s===void 0))throw new Error(`cannot find a playable note for ${JSON.stringify(e)}`);if(typeof s=="number"&&n.type!=="frequency")s=at(t.value);else if(typeof s=="number"&&n.type==="frequency")s=t.value;else if(typeof s!="string"||!Tt(s))throw new Error("not a note: "+JSON.stringify(s));return s},Ta=t=>{let{value:e,context:n}=t;if(typeof e=="object")return e.freq?e.freq:xe(e.note||e.n||e.value);if(typeof e=="number"&&n.type!=="frequency")e=at(t.value);else if(typeof e=="string"&&Tt(e))e=at(_t(t.value));else if(typeof e!="number")throw new Error("not a note or frequency: "+e);return e},Ee=(t,e)=>t.slice(e).concat(t.slice(0,e)),Ne=(...t)=>t.reduce((e,n)=>(...s)=>e(n(...s)),e=>e),Ca=(...t)=>Ne(...t.reverse()),ft=t=>t.filter(e=>e!=null),X=t=>[].concat(...t),ut=t=>t,xa=(t,e)=>t,kt=(t,e)=>Array.from({length:e-t+1},(n,s)=>s+t);function v(t,e,n=t.length){const s=function r(...o){if(o.length>=n)return t.apply(this,o);{const i=function(...u){return r.apply(this,o.concat(u))};return e&&e(i,o),i}};return e&&e(s,[]),s}function Qt(t){const e=Number(t);if(!isNaN(e))return e;if(Tt(t))return _t(t);throw new Error(`cannot parse as numeral: "${t}"`)}function Ut(t,e){return(...n)=>t(...n.map(e))}function D(t){return Ut(t,Qt)}function Me(t){const e=Number(t);if(!isNaN(e))return e;const n={pi:Math.PI,w:1,h:.5,q:.25,e:.125,s:.0625,t:1/3,f:.2,x:1/6}[t];if(typeof n<"u")return n;throw new Error(`cannot parse as fractional: "${t}"`)}const Oa=t=>Ut(t,Me),Kt=function(t,e){return[e.slice(0,t),e.slice(t)]},Ct=(t,e,n)=>e.map((s,r)=>t(s,n[r])),Pe=function(t){const e=[];for(let n=0;n<t.length-1;++n)e.push([t[n],t[n+1]]);return e},Ie=(t,e,n)=>Math.min(Math.max(t,e),n),za=["Do","Reb","Re","Mib","Mi","Fa","Solb","Sol","Lab","La","Sib","Si"],Ea=["Sa","Re","Ga","Ma","Pa","Dha","Ni"],Na=["C","Db","D","Eb","E","F","Gb","G","Ab","A","Hb","H"],Ma=["Ni","Pab","Pa","Voub","Vou","Ga","Dib","Di","Keb","Ke","Zob","Zo"],Pa=["I","Ro","Ha","Ni","Ho","He","To"],Ia=["C","Db","D","Eb","E","F","Gb","G","Ab","A","Bb","B"],ja=(t,e="letters")=>{const s=(e==="solfeggio"?za:e==="indian"?Ea:e==="german"?Na:e==="byzantine"?Ma:e==="japanese"?Pa:Ia)[t%12],r=Math.floor(t/12)-1;return s+r};function Ja(t){var e={};return t.filter(function(n){return e.hasOwn(n)?!1:e[n]=!0})}function Wa(t){return t.sort().filter(function(e,n,s){return!n||e!=s[n-1]})}function je(t){return t.sort((e,n)=>e.compare(n)).filter(function(e,n,s){return!n||e.ne(s[n-1])})}function Je(t){const e=new TextEncoder().encode(t);return btoa(String.fromCharCode(...e))}function We(t){const e=new Uint8Array(atob(t).split("").map(s=>s.charCodeAt(0)));return new TextDecoder().decode(e)}function $a(t){return encodeURIComponent(Je(t))}function Ra(t){return We(decodeURIComponent(t))}function $e(t,e){return Array.isArray(t)?t.map(e):Object.fromEntries(Object.entries(t).map(([n,s],r)=>[n,e(s,n,r)]))}function Jt(t,e){return t/e}class Re{constructor({getTargetClockTime:e=Fa,weight:n=16,offsetDelta:s=.005,checkAfterTime:r=2,resetAfterTime:o=8}){this.offsetTime,this.timeAtPrevOffsetSample,this.prevOffsetTimes=[],this.getTargetClockTime=e,this.weight=n,this.offsetDelta=s,this.checkAfterTime=r,this.resetAfterTime=o,this.reset=()=>{this.prevOffsetTimes=[],this.offsetTime=null,this.timeAtPrevOffsetSample=null}}calculateOffset(e){const n=this.getTargetClockTime(),s=n-this.timeAtPrevOffsetSample,r=n-e;if(s>this.resetAfterTime&&this.reset(),this.offsetTime==null&&(this.offsetTime=r),this.prevOffsetTimes.push(r),this.prevOffsetTimes.length>this.weight&&this.prevOffsetTimes.shift(),this.timeAtPrevOffsetSample==null||s>this.checkAfterTime){this.timeAtPrevOffsetSample=n;const o=Oe(this.prevOffsetTimes);Math.abs(o-this.offsetTime)>this.offsetDelta&&(this.offsetTime=o)}return this.offsetTime}calculateTimestamp(e,n){return this.calculateOffset(e)+n}}function La(){return performance.now()*.001}function Fa(){return Date.now()*.001}const Le=new Map([["control","Control"],["ctrl","Control"],["alt","Alt"],["shift","Shift"],["down","ArrowDown"],["up","ArrowUp"],["left","ArrowLeft"],["right","ArrowRight"]]);let mt;function Fe(){if(mt==null){if(typeof window>"u")return;mt={},window.addEventListener("keydown",t=>{mt[t.key]=!0}),window.addEventListener("keyup",t=>{mt[t.key]=!1})}return{...mt}}function Zt(t,e=!1){return typeof t=="object"?e?JSON.stringify(t).slice(1,-1).replaceAll('"',"").replaceAll(","," "):JSON.stringify(t):t}S.prototype.sam=function(){return this.floor()};S.prototype.nextSam=function(){return this.sam().add(1)};S.prototype.wholeCycle=function(){return new E(this.sam(),this.nextSam())};S.prototype.cyclePos=function(){return this.sub(this.sam())};S.prototype.lt=function(t){return this.compare(t)<0};S.prototype.gt=function(t){return this.compare(t)>0};S.prototype.lte=function(t){return this.compare(t)<=0};S.prototype.gte=function(t){return this.compare(t)>=0};S.prototype.eq=function(t){return this.compare(t)==0};S.prototype.ne=function(t){return this.compare(t)!=0};S.prototype.max=function(t){return this.gt(t)?this:t};S.prototype.maximum=function(...t){return t=t.map(e=>new S(e)),t.reduce((e,n)=>n.max(e),this)};S.prototype.min=function(t){return this.lt(t)?this:t};S.prototype.mulmaybe=function(t){return t!==void 0?this.mul(t):void 0};S.prototype.divmaybe=function(t){return t!==void 0?this.div(t):void 0};S.prototype.addmaybe=function(t){return t!==void 0?this.add(t):void 0};S.prototype.submaybe=function(t){return t!==void 0?this.sub(t):void 0};S.prototype.show=function(){return this.s*this.n+"/"+this.d};S.prototype.or=function(t){return this.eq(0)?t:this};const m=t=>S(t),Da=(...t)=>{if(t=ft(t),t.length!==0)return t.reduce((e,n)=>e.gcd(n),m(1))},it=(...t)=>{if(t=ft(t),t.length===0)return;const e=t.pop();return t.reduce((n,s)=>n===void 0||s===void 0?void 0:n.lcm(s),e)},Ha=t=>t instanceof S;m._original=S;class E{constructor(e,n){this.begin=m(e),this.end=m(n)}get spanCycles(){const e=[];var n=this.begin;const s=this.end,r=s.sam();if(n.equals(s))return[new E(n,s)];for(;s.gt(n);){if(n.sam().equals(r)){e.push(new E(n,this.end));break}const o=n.nextSam();e.push(new E(n,o)),n=o}return e}get duration(){return this.end.sub(this.begin)}cycleArc(){const e=this.begin.cyclePos(),n=e.add(this.duration);return new E(e,n)}withTime(e){return new E(e(this.begin),e(this.end))}withEnd(e){return new E(this.begin,e(this.end))}withCycle(e){const n=this.begin.sam(),s=n.add(e(this.begin.sub(n))),r=n.add(e(this.end.sub(n)));return new E(s,r)}intersection(e){const n=this.begin.max(e.begin),s=this.end.min(e.end);if(!n.gt(s)&&!(n.equals(s)&&(n.equals(this.end)&&this.begin.lt(this.end)||n.equals(e.end)&&e.begin.lt(e.end))))return new E(n,s)}intersection_e(e){const n=this.intersection(e);if(n==null)throw"TimeSpans do not intersect";return n}midpoint(){return this.begin.add(this.duration.div(m(2)))}equals(e){return this.begin.equals(e.begin)&&this.end.equals(e.end)}show(){return this.begin.show()+" → "+this.end.show()}}class z{constructor(e,n,s,r={},o=!1){this.whole=e,this.part=n,this.value=s,this.context=r,this.stateful=o,o&&console.assert(typeof this.value=="function","Stateful values must be functions")}get duration(){let e;return typeof this.value?.duration=="number"?e=m(this.value.duration):e=this.whole.end.sub(this.whole.begin),typeof this.value?.clip=="number"?e.mul(this.value.clip):e}get endClipped(){return this.whole.begin.add(this.duration)}isActive(e){return this.whole.begin<=e&&this.endClipped>=e}isInPast(e){return e>this.endClipped}isInNearPast(e,n){return n-e<=this.endClipped}isInFuture(e){return e<this.whole.begin}isInNearFuture(e,n){return n<this.whole.begin&&n>this.whole.begin-e}isWithinTime(e,n){return this.whole.begin<=n&&this.endClipped>=e}wholeOrPart(){return this.whole?this.whole:this.part}withSpan(e){const n=this.whole?e(this.whole):void 0;return new z(n,e(this.part),this.value,this.context)}withValue(e){return new z(this.whole,this.part,e(this.value),this.context)}hasOnset(){return this.whole!=null&&this.whole.begin.equals(this.part.begin)}hasTag(e){return this.context.tags?.includes(e)}resolveState(e){if(this.stateful&&this.hasOnset()){console.log("stateful");const n=this.value,[s,r]=n(e);return[s,new z(this.whole,this.part,r,this.context,!1)]}return[e,this]}spanEquals(e){return this.whole==null&&e.whole==null||this.whole.equals(e.whole)}equals(e){return this.spanEquals(e)&&this.part.equals(e.part)&&this.value===e.value}show(e=!1){const n=typeof this.value=="object"?e?JSON.stringify(this.value).slice(1,-1).replaceAll('"',"").replaceAll(","," "):JSON.stringify(this.value):this.value;var s="";if(this.whole==null)s="~"+this.part.show;else{var r=this.whole.begin.equals(this.part.begin)&&this.whole.end.equals(this.part.end);this.whole.begin.equals(this.part.begin)||(s=this.whole.begin.show()+" ⇜ "),r||(s+="("),s+=this.part.show(),r||(s+=")"),this.whole.end.equals(this.part.end)||(s+=" ⇝ "+this.whole.end.show())}return"[ "+s+" | "+n+" ]"}showWhole(e=!1){return`${this.whole==null?"~":this.whole.show()}: ${Zt(this.value,e)}`}combineContext(e){const n=this;return{...n.context,...e.context,locations:(n.context.locations||[]).concat(e.context.locations||[])}}setContext(e){return new z(this.whole,this.part,this.value,e)}ensureObjectValue(){if(typeof this.value!="object")throw new Error(`expected hap.value to be an object, but got "${this.value}". Hint: append .note() or .s() to the end`,"error")}}class lt{constructor(e,n={}){this.span=e,this.controls=n}setSpan(e){return new lt(e,this.controls)}withSpan(e){return this.setSpan(e(this.span))}setControls(e){return new lt(this.span,e)}}function Va(t,e,n){if(e?.value!==void 0&&Object.keys(e).length===1)return j("[warn]: Can't do arithmetic on control pattern."),t;const s=Object.keys(t).filter(r=>Object.keys(e).includes(r));return Object.assign({},t,e,Object.fromEntries(s.map(r=>[r,n(t[r],e[r])])))}v((t,e)=>t*e);v((t,e)=>e.map(t));function De(t,e=60){let n=0,s=m(0),r=[""],o="";for(;r[0].length<e;){const i=t.queryArc(n,n+1),u=i.filter(h=>h.hasOnset()).map(h=>h.duration),a=Da(...u),l=a.inverse();r=r.map(h=>h+"|"),o+="|";for(let h=0;h<l;h++){const[p,k]=[s,s.add(a)],_=i.filter(C=>C.whole.begin.lte(p)&&C.whole.end.gte(k)),A=_.length-r.length;A>0&&(r=r.concat(Array(A).fill(o))),r=r.map((C,R)=>{const L=_[R];if(L){const O=L.whole.begin.eq(p)?""+L.value:"-";return C+O}return C+"."}),o+=".",s=s.add(a)}n++}return r.join(`
`)}let Wt,V=!0;const Ga=function(t){V=!!t},Qa=t=>Wt=t;class d{constructor(e,n=void 0){this.query=e,this._Pattern=!0,this._steps=n}get _steps(){return this.__steps}set _steps(e){this.__steps=e===void 0?void 0:m(e)}setSteps(e){return this._steps=e,this}withSteps(e){return V?new d(this.query,this._steps===void 0?void 0:e(this._steps)):this}get hasSteps(){return this._steps!==void 0}withValue(e){const n=new d(s=>this.query(s).map(r=>r.withValue(e)));return n._steps=this._steps,n}withState(e){return this.withHaps((n,s)=>(e(s),n))}fmap(e){return this.withValue(e)}appWhole(e,n){const s=this,r=function(o){const i=s.query(o),u=n.query(o),a=function(l,h){const p=l.part.intersection(h.part);if(p!=null)return new z(e(l.whole,h.whole),p,l.value(h.value),h.combineContext(l))};return X(i.map(l=>ft(u.map(h=>a(l,h)))))};return new d(r)}appBoth(e){const n=this,s=function(o,i){if(!(o==null||i==null))return o.intersection_e(i)},r=n.appWhole(s,e);return V&&(r._steps=it(e._steps,n._steps)),r}appLeft(e){const n=this,s=function(o){const i=[];for(const u of n.query(o)){const a=e.query(o.setSpan(u.wholeOrPart()));for(const l of a){const h=u.whole,p=u.part.intersection(l.part);if(p){const k=u.value(l.value),_=l.combineContext(u),A=new z(h,p,k,_);i.push(A)}}}return i},r=new d(s);return r._steps=this._steps,r}appRight(e){const n=this,s=function(o){const i=[];for(const u of e.query(o)){const a=n.query(o.setSpan(u.wholeOrPart()));for(const l of a){const h=u.whole,p=l.part.intersection(u.part);if(p){const k=l.value(u.value),_=u.combineContext(l),A=new z(h,p,k,_);i.push(A)}}}return i},r=new d(s);return r._steps=e._steps,r}bindWhole(e,n){const s=this,r=function(o){const i=function(a,l){return new z(e(a.whole,l.whole),l.part,l.value,Object.assign({},a.context,l.context,{locations:(a.context.locations||[]).concat(l.context.locations||[])}))},u=function(a){return n(a.value).query(o.setSpan(a.part)).map(l=>i(a,l))};return X(s.query(o).map(a=>u(a)))};return new d(r)}bind(e){const n=function(s,r){if(!(s==null||r==null))return s.intersection_e(r)};return this.bindWhole(n,e)}join(){return this.bind(ut)}outerBind(e){return this.bindWhole(n=>n,e).setSteps(this._steps)}outerJoin(){return this.outerBind(ut)}innerBind(e){return this.bindWhole((n,s)=>s,e)}innerJoin(){return this.innerBind(ut)}resetJoin(e=!1){const n=this;return new d(s=>n.discreteOnly().query(s).map(r=>r.value.late(e?r.whole.begin:r.whole.begin.cyclePos()).query(s).map(o=>new z(o.whole?o.whole.intersection(r.whole):void 0,o.part.intersection(r.part),o.value).setContext(r.combineContext(o))).filter(o=>o.part)).flat())}restartJoin(){return this.resetJoin(!0)}squeezeJoin(){const e=this;function n(s){const r=e.discreteOnly().query(s);function o(u){const l=u.value._focusSpan(u.wholeOrPart()).query(s.setSpan(u.part));function h(p,k){let _;if(k.whole&&p.whole&&(_=k.whole.intersection(p.whole),!_))return;const A=k.part.intersection(p.part);if(!A)return;const C=k.combineContext(p);return new z(_,A,k.value,C)}return l.map(p=>h(u,p))}return X(r.map(o)).filter(u=>u)}return new d(n)}squeezeBind(e){return this.fmap(e).squeezeJoin()}polyJoin=function(){const e=this;return e.fmap(n=>n.extend(e._steps.div(n._steps))).outerJoin()};polyBind(e){return this.fmap(e).polyJoin()}queryArc(e,n,s={}){try{return this.query(new lt(new E(e,n),s))}catch(r){return j(`[query]: ${r.message}`,"error"),[]}}splitQueries(){const e=this,n=s=>X(s.span.spanCycles.map(r=>e.query(s.setSpan(r))));return new d(n)}withQuerySpan(e){return new d(n=>this.query(n.withSpan(e)))}withQuerySpanMaybe(e){const n=this;return new d(s=>{const r=s.withSpan(e);return r.span?n.query(r):[]})}withQueryTime(e){return new d(n=>this.query(n.withSpan(s=>s.withTime(e))))}withHapSpan(e){return new d(n=>this.query(n).map(s=>s.withSpan(e)))}withHapTime(e){return this.withHapSpan(n=>n.withTime(e))}withHaps(e){const n=new d(s=>e(this.query(s),s));return n._steps=this._steps,n}withHap(e){return this.withHaps(n=>n.map(e))}setContext(e){return this.withHap(n=>n.setContext(e))}withContext(e){const n=this.withHap(s=>s.setContext(e(s.context)));return this.__pure!==void 0&&(n.__pure=this.__pure,n.__pure_loc=this.__pure_loc),n}stripContext(){return this.withHap(e=>e.setContext({}))}withLoc(e,n){const s={start:e,end:n},r=this.withContext(o=>{const i=(o.locations||[]).concat([s]);return{...o,locations:i}});return this.__pure&&(r.__pure=this.__pure,r.__pure_loc=s),r}filterHaps(e){return new d(n=>this.query(n).filter(e))}filterValues(e){return new d(n=>this.query(n).filter(s=>e(s.value))).setSteps(this._steps)}removeUndefineds(){return this.filterValues(e=>e!=null)}onsetsOnly(){return this.filterHaps(e=>e.hasOnset())}discreteOnly(){return this.filterHaps(e=>e.whole)}defragmentHaps(){return this.discreteOnly().withHaps(n=>{const s=[];for(var r=0;r<n.length;++r){for(var o=!0,i=n[r];o;){const l=JSON.stringify(n[r].value);for(var u=!1,a=r+1;a<n.length;a++){const h=n[a];if(i.whole.equals(h.whole)){if(i.part.begin.eq(h.part.end)){if(l===JSON.stringify(h.value)){i=new z(i.whole,new E(h.part.begin,i.part.end),i.value),n.splice(a,1),u=!0;break}}else if(h.part.begin.eq(i.part.end)&&l==JSON.stringify(h.value)){i=new z(i.whole,new E(i.part.begin,h.part.end),i.value),n.splice(a,1),u=!0;break}}}o=u}s.push(i)}return s})}firstCycle(e=!1){var n=this;return e||(n=n.stripContext()),n.query(new lt(new E(m(0),m(1))))}get firstCycleValues(){return this.firstCycle().map(e=>e.value)}get showFirstCycle(){return this.firstCycle().map(e=>`${e.value}: ${e.whole.begin.toFraction()} - ${e.whole.end.toFraction()}`)}sortHapsByPart(){return this.withHaps(e=>e.sort((n,s)=>n.part.begin.sub(s.part.begin).or(n.part.end.sub(s.part.end)).or(n.whole.begin.sub(s.whole.begin).or(n.whole.end.sub(s.whole.end)))))}asNumber(){return this.fmap(Qt)}_opIn(e,n){return this.fmap(n).appLeft(y(e))}_opOut(e,n){return this.fmap(n).appRight(y(e))}_opMix(e,n){return this.fmap(n).appBoth(y(e))}_opSqueeze(e,n){const s=y(e);return this.fmap(r=>s.fmap(o=>n(r)(o))).squeezeJoin()}_opSqueezeOut(e,n){const s=this;return y(e).fmap(o=>s.fmap(i=>n(i)(o))).squeezeJoin()}_opReset(e,n){return y(e).fmap(r=>this.fmap(o=>n(o)(r))).resetJoin()}_opRestart(e,n){return y(e).fmap(r=>this.fmap(o=>n(o)(r))).restartJoin()}_opPoly(e,n){const s=y(e);return this.fmap(r=>s.fmap(o=>n(o)(r))).polyJoin()}layer(...e){return N(...e.map(n=>n(this)))}superimpose(...e){return this.stack(...e.map(n=>n(this)))}stack(...e){return N(this,...e)}sequence(...e){return Y(this,...e)}seq(...e){return Y(this,...e)}cat(...e){return wt(this,...e)}fastcat(...e){return $(this,...e)}slowcat(...e){return nt(this,...e)}onTrigger(e,n=!0){return this.withHap(s=>s.setContext({...s.context,onTrigger:(...r)=>{s.context.onTrigger?.(...r),e(...r)},dominantTrigger:s.context.dominantTrigger||n}))}log(e=s=>`[hap] ${s.showWhole(!0)}`,n=s=>({hap:s})){return this.onTrigger((...s)=>{j(e(...s),void 0,n(...s))},!1)}logValues(e=n=>`[hap] ${Zt(n,!0)}`){return this.log(n=>e(n.value))}drawLine(){return console.log(De(this)),this}unjoin(e,n=ut){return e.withHap(s=>s.withValue(r=>r?n(this.ribbon(s.whole.begin,s.whole.duration)):this))}into(e,n){return this.unjoin(e,n).innerJoin()}}function Ua(t,e){let n=[];return e.forEach(s=>{const r=n.findIndex(([o])=>t(s,o));r===-1?n.push([s]):n[r].push(s)}),n}const Ka=(t,e)=>t.spanEquals(e);d.prototype.collect=function(){return this.withHaps(t=>Ua(Ka,t).map(e=>new z(e[0].whole,e[0].part,e,{})))};const Za=f("arpWith",(t,e)=>e.collect().fmap(n=>y(t(n))).innerJoin().withHap(n=>new z(n.whole,n.part,n.value.value,n.combineContext(n.value)))),Xa=f("arp",(t,e)=>e.arpWith(n=>y(t).fmap(s=>n[s%n.length])),!1);function St(t){return!Array.isArray(t)&&typeof t=="object"&&!Ha(t)}function Ya(t,e,n){return St(t)||St(e)?(St(t)||(t={value:t}),St(e)||(e={value:e}),Va(t,e,n)):n(t,e)}(function(){const t={set:[(n,s)=>s],keep:[n=>n],keepif:[(n,s)=>s?n:void 0],add:[D((n,s)=>n+s)],sub:[D((n,s)=>n-s)],mul:[D((n,s)=>n*s)],div:[D((n,s)=>n/s)],mod:[D(vt)],pow:[D(Math.pow)],log2:[D(Math.log2)],band:[D((n,s)=>n&s)],bor:[D((n,s)=>n|s)],bxor:[D((n,s)=>n^s)],blshift:[D((n,s)=>n<<s)],brshift:[D((n,s)=>n>>s)],lt:[(n,s)=>n<s],gt:[(n,s)=>n>s],lte:[(n,s)=>n<=s],gte:[(n,s)=>n>=s],eq:[(n,s)=>n==s],eqt:[(n,s)=>n===s],ne:[(n,s)=>n!=s],net:[(n,s)=>n!==s],and:[(n,s)=>n&&s],or:[(n,s)=>n||s],func:[(n,s)=>s(n)]},e=["In","Out","Mix","Squeeze","SqueezeOut","Reset","Restart","Poly"];for(const[n,[s,r]]of Object.entries(t)){d.prototype["_"+n]=function(o){return this.fmap(i=>s(i,o))},Object.defineProperty(d.prototype,n,{get:function(){const o=this,i=(...u)=>o[n].in(...u);for(const u of e)i[u.toLowerCase()]=function(...a){var l=o;a=Y(a),r&&(l=r(l),a=r(a));var h;return n==="keepif"?(h=l["_op"+u](a,p=>k=>s(p,k)),h=h.removeUndefineds()):h=l["_op"+u](a,p=>k=>Ya(p,k,s)),h};return i.squeezein=i.squeeze,i}});for(const o of e)d.prototype[o.toLowerCase()]=function(...i){return this.set[o.toLowerCase()](i)}}d.prototype.struct=function(...n){return this.keepif.out(...n)},d.prototype.structAll=function(...n){return this.keep.out(...n)},d.prototype.mask=function(...n){return this.keepif.in(...n)},d.prototype.maskAll=function(...n){return this.keep.in(...n)},d.prototype.reset=function(...n){return this.keepif.reset(...n)},d.prototype.resetAll=function(...n){return this.keep.reset(...n)},d.prototype.restart=function(...n){return this.keepif.restart(...n)},d.prototype.restartAll=function(...n){return this.keep.restart(...n)}})();const tl=N,el=N,nl=xt,pt=t=>new d(()=>[],t),B=pt(1),H=pt(0);function I(t){function e(s){return s.span.spanCycles.map(r=>new z(m(r.begin).wholeCycle(),r,t))}const n=new d(e,1);return n.__pure=t,n}function Xt(t){return t instanceof d||t?._Pattern}function y(t){return Xt(t)?t:Wt&&typeof t=="string"?Wt(t):I(t)}function He(t){let e=I([]);for(const n of t)e=e.bind(s=>n.fmap(r=>s.concat([r])));return e}function N(...t){t=t.map(s=>Array.isArray(s)?Y(...s):y(s));const e=s=>X(t.map(r=>r.query(s))),n=new d(e);return V&&(n._steps=it(...t.map(s=>s._steps))),n}function Yt(t,e){if(e=e.map(o=>Array.isArray(o)?Y(...o):y(o)),e.length===0)return B;if(e.length===1)return e[0];const[n,...s]=e.map(o=>o._steps),r=V?n.maximum(...s):void 0;return N(...t(r,e))}function Ve(...t){return Yt((e,n)=>n.map(s=>s._steps.eq(e)?s:W(s,pt(e.sub(s._steps)))),t)}function Ge(...t){return Yt((e,n)=>n.map(s=>s._steps.eq(e)?s:W(pt(e.sub(s._steps)),s)),t)}function Qe(...t){return Yt((e,n)=>n.map(s=>{if(s._steps.eq(e))return s;const r=pt(e.sub(s._steps).div(2));return W(r,s,r)}),t)}function sl(t,...e){const[n,...s]=e.map(i=>i._steps),r=n.maximum(...s),o={centre:Qe,left:Ve,right:Ge,expand:N,repeat:(...i)=>xt(...i).steps(r)};return t.inhabit(o).fmap(i=>i(...e)).innerJoin().setSteps(r)}function nt(...t){if(t=t.map(s=>Array.isArray(s)?$(...s):y(s)),t.length==1)return t[0];const e=function(s){const r=s.span,o=vt(r.begin.sam(),t.length),i=t[o];if(!i)return[];const u=r.begin.floor().sub(r.begin.div(t.length).floor());return i.withHapTime(a=>a.add(u)).query(s.setSpan(r.withTime(a=>a.sub(u))))},n=V?it(...t.map(s=>s._steps)):void 0;return new d(e).splitQueries().setSteps(n)}function te(...t){t=t.map(y);const e=function(n){const s=Math.floor(n.span.begin)%t.length;return t[s]?.query(n)||[]};return new d(e).splitQueries()}function wt(...t){return nt(...t)}function rl(...t){const e=t.reduce((n,[s])=>n+s,0);return t=t.map(([n,s])=>[n,s.fast(n)]),W(...t).slow(e)}function ol(...t){let e=m(0);for(let n of t)n.length==2&&n.unshift(e),e=n[1];return N(...t.map(([n,s,r])=>I(y(r)).compress(m(n).div(e),m(s).div(e)))).slow(e).innerJoin()}function $(...t){let e=nt(...t);return t.length>1&&(e=e._fast(t.length),e._steps=t.length),t.length==1&&t[0].__steps_source&&(t._steps=t[0]._steps),e}function Y(...t){return $(...t)}function Ue(...t){return $(...t)}function $t(t){return Array.isArray(t)?t.length==0?[B,0]:t.length==1?$t(t[0]):[$(...t.map(e=>$t(e)[0])),t.length]:[y(t),1]}const il=v((t,e)=>y(e).mask(t)),cl=v((t,e)=>y(e).struct(t)),ul=v((t,e)=>y(e).superimpose(...t)),al=v((t,e)=>y(e).withValue(t)),ll=v((t,e)=>y(e).bind(t)),fl=v((t,e)=>y(e).innerBind(t)),pl=v((t,e)=>y(e).outerBind(t)),hl=v((t,e)=>y(e).squeezeBind(t)),dl=v((t,e)=>y(e).stepBind(t)),ml=v((t,e)=>y(e).polyBind(t)),yl=v((t,e)=>y(e).set(t)),wl=v((t,e)=>y(e).keep(t)),gl=v((t,e)=>y(e).keepif(t)),bl=v((t,e)=>y(e).add(t)),_l=v((t,e)=>y(e).sub(t)),vl=v((t,e)=>y(e).mul(t)),kl=v((t,e)=>y(e).div(t)),ql=v((t,e)=>y(e).mod(t)),Al=v((t,e)=>y(e).pow(t)),Sl=v((t,e)=>y(e).band(t)),Bl=v((t,e)=>y(e).bor(t)),Tl=v((t,e)=>y(e).bxor(t)),Cl=v((t,e)=>y(e).blshift(t)),xl=v((t,e)=>y(e).brshift(t)),Ol=v((t,e)=>y(e).lt(t)),zl=v((t,e)=>y(e).gt(t)),El=v((t,e)=>y(e).lte(t)),Nl=v((t,e)=>y(e).gte(t)),Ml=v((t,e)=>y(e).eq(t)),Pl=v((t,e)=>y(e).eqt(t)),Il=v((t,e)=>y(e).ne(t)),jl=v((t,e)=>y(e).net(t)),Jl=v((t,e)=>y(e).and(t)),Wl=v((t,e)=>y(e).or(t)),$l=v((t,e)=>y(e).func(t));function f(t,e,n=!0,s=!1,r=o=>o.innerJoin()){if(Array.isArray(t)){const u={};for(const a of t)u[a]=f(a,e,n,s,r);return u}const o=e.length;var i;return n?i=function(...u){u=u.map(y);const a=u[u.length-1];let l;if(o===1)l=e(a);else{const h=u.slice(0,-1);if(h.every(p=>p.__pure!=null)){const p=h.map(_=>_.__pure),k=h.filter(_=>_.__pure_loc).map(_=>_.__pure_loc);l=e(...p,a),l=l.withContext(_=>{const A=(_.locations||[]).concat(k);return{..._,locations:A}})}else{const[p,...k]=h;let _=(...A)=>e(...A,a);_=v(_,null,o-1),l=r(k.reduce((A,C)=>A.appLeft(C),p.fmap(_)))}}return s&&(l._steps=a._steps),l}:i=function(...u){u=u.map(y);const a=e(...u);return s&&(a._steps=u[u.length-1]._steps),a},d.prototype[t]=function(...u){if(o===2&&u.length!==1)u=[Y(...u)];else if(o!==u.length+1)throw new Error(`.${t}() expects ${o-1} inputs but got ${u.length}.`);return u=u.map(y),i(...u,this)},o>1&&(d.prototype["_"+t]=function(...u){const a=e(...u,this);return s&&a.setSteps(this._steps),a}),v(i,null,o)}function qt(t,e,n=!0,s=!1,r=o=>o.stepJoin()){return f(t,e,n,s,r)}const Rl=f("round",function(t){return t.asNumber().fmap(e=>Math.round(e))}),Ll=f("floor",function(t){return t.asNumber().fmap(e=>Math.floor(e))}),Fl=f("ceil",function(t){return t.asNumber().fmap(e=>Math.ceil(e))}),Dl=f("toBipolar",function(t){return t.fmap(e=>e*2-1)}),Hl=f("fromBipolar",function(t){return t.fmap(e=>(e+1)/2)}),Vl=f("range",function(t,e,n){return n.mul(e-t).add(t)}),Gl=f("rangex",function(t,e,n){return n._range(Math.log(t),Math.log(e)).fmap(Math.exp)}),Ql=f("range2",function(t,e,n){return n.fromBipolar()._range(t,e)}),Ul=f("ratio",t=>t.fmap(e=>Array.isArray(e)?e.slice(1).reduce((n,s)=>n/s,e[0]):e)),Kl=f("compress",function(t,e,n){return t=m(t),e=m(e),t.gt(e)||t.gt(1)||e.gt(1)||t.lt(0)||e.lt(0)?B:n._fastGap(m(1).div(e.sub(t)))._late(t)}),{compressSpan:Zl,compressspan:Xl}=f(["compressSpan","compressspan"],function(t,e){return e._compress(t.begin,t.end)}),{fastGap:Yl,fastgap:tf}=f(["fastGap","fastgap"],function(t,e){const n=function(r){const o=r.begin.sam(),i=r.begin.sub(o).mul(t).min(1),u=r.end.sub(o).mul(t).min(1);if(!(i>=1))return new E(o.add(i),o.add(u))},s=function(r){const o=r.part.begin,i=r.part.end,u=o.sam(),a=o.sub(u).div(t).min(1),l=i.sub(u).div(t).min(1),h=new E(u.add(a),u.add(l)),p=r.whole?new E(h.begin.sub(o.sub(r.whole.begin).div(t)),h.end.add(r.whole.end.sub(i).div(t))):void 0;return new z(p,h,r.value,r.context)};return e.withQuerySpanMaybe(n).withHap(s).splitQueries()}),ef=f("focus",function(t,e,n){return t=m(t),e=m(e),n._early(t.sam())._fast(m(1).div(e.sub(t)))._late(t)}),{focusSpan:nf,focusspan:sf}=f(["focusSpan","focusspan"],function(t,e){return e._focus(t.begin,t.end)}),rf=f("ply",function(t,e){const n=e.fmap(s=>I(s)._fast(t)).squeezeJoin();return V&&(n._steps=m(t).mulmaybe(e._steps)),n}),{fast:of,density:bd}=f(["fast","density"],function(t,e){return t===0?B:(t=m(t),e.withQueryTime(s=>s.mul(t)).withHapTime(s=>s.div(t)).setSteps(e._steps))},!0,!0),cf=f("hurry",function(t,e){return e._fast(t).mul(I({speed:t}))}),{slow:uf,sparsity:af}=f(["slow","sparsity"],function(t,e){return t===0?B:e._fast(m(1).div(t))}),lf=f("inside",function(t,e,n){return e(n._slow(t))._fast(t)}),ff=f("outside",function(t,e,n){return e(n._fast(t))._slow(t)}),pf=f("lastOf",function(t,e,n){const s=Array(t-1).fill(n);return s.push(e(n)),te(...s)}),{firstOf:hf,every:df}=f(["firstOf","every"],function(t,e,n){const s=Array(t-1).fill(n);return s.unshift(e(n)),te(...s)}),mf=f("apply",function(t,e){return t(e)}),yf=f("cpm",function(t,e){return e._fast(t/60/1)}),wf=f("early",function(t,e){return t=m(t),e.withQueryTime(n=>n.add(t)).withHapTime(n=>n.sub(t))},!0,!0),Ke=f("late",function(t,e){return t=m(t),e._early(m(0).sub(t))},!0,!0),gf=f("zoom",function(t,e,n){if(e=m(e),t=m(t),t.gte(e))return H;const s=e.sub(t),r=V?n._steps?.mulmaybe(s):void 0;return n.withQuerySpan(o=>o.withCycle(i=>i.mul(s).add(t))).withHapSpan(o=>o.withCycle(i=>i.sub(t).div(s))).splitQueries().setSteps(r)}),{zoomArc:bf,zoomarc:_f}=f(["zoomArc","zoomarc"],function(t,e){return e.zoom(t.begin,t.end)}),vf=f("bite",(t,e,n)=>e.fmap(s=>r=>{const o=m(s).div(r).mod(1),i=o.add(m(1).div(r));return n.zoom(o,i)}).appLeft(t).squeezeJoin(),!1),kf=f("linger",function(t,e){return t==0?B:t<0?e._zoom(t.add(1),1)._slow(t):e._zoom(0,t)._slow(t)},!0,!0),{segment:qf,seg:Af}=f(["segment","seg"],function(t,e){return e.struct(I(!0)._fast(t)).setSteps(t)}),Sf=f("swingBy",(t,e,n)=>n.inside(e,Ke(Ue(0,t/2)))),Bf=f("swing",(t,e)=>e.swingBy(1/3,t)),{invert:Tf,inv:Cf}=f(["invert","inv"],function(t){return t.fmap(e=>!e)},!0,!0),xf=f("when",function(t,e,n){return t?e(n):n}),Of=f("off",function(t,e,n){return N(n,e(n.late(t)))}),zf=f("brak",function(t){return t.when(nt(!1,!0),e=>$(e,B)._late(.25))}),Ze=f("rev",function(t){const e=function(n){const s=n.span,r=s.begin.sam(),o=s.begin.nextSam(),i=function(a){const l=a.withTime(p=>r.add(o.sub(p))),h=l.begin;return l.begin=l.end,l.end=h,l};return t.query(n.setSpan(i(s))).map(a=>a.withSpan(i))};return new d(e).splitQueries()},!1,!0),Ef=f("pressBy",function(t,e){return e.fmap(n=>I(n).compress(t,1)).squeezeJoin()}),Nf=f("press",function(t){return t._pressBy(.5)});d.prototype.hush=function(){return B};const Mf=f("palindrome",function(t){return t.lastOf(2,Ze)},!0,!0),{juxBy:Pf,juxby:If}=f(["juxBy","juxby"],function(t,e,n){t/=2;const s=function(i,u,a){return u in i?i[u]:a},r=n.withValue(i=>Object.assign({},i,{pan:s(i,"pan",.5)-t})),o=e(n.withValue(i=>Object.assign({},i,{pan:s(i,"pan",.5)+t})));return N(r,o).setSteps(V?it(r._steps,o._steps):void 0)}),jf=f("jux",function(t,e){return e._juxBy(1,t,e)}),{echoWith:Jf,echowith:Wf,stutWith:$f,stutwith:Rf}=f(["echoWith","echowith","stutWith","stutwith"],function(t,e,n,s){return N(...kt(0,t-1).map(r=>n(s.late(m(e).mul(r)),r)))}),Lf=f("echo",function(t,e,n,s){return s._echoWith(t,e,(r,o)=>r.gain(Math.pow(n,o)))}),Ff=f("stut",function(t,e,n,s){return s._echoWith(t,n,(r,o)=>r.gain(Math.pow(e,o)))}),Xe=f("applyN",function(t,e,n){let s=n;for(let r=0;r<t;r++)s=e(s);return s}),Df=f(["plyWith","plywith"],function(t,e,n){const s=n.fmap(r=>wt(...kt(0,t-1).map(o=>Xe(o,e,r)))._fast(t)).squeezeJoin();return V&&(s._steps=m(t).mulmaybe(n._steps)),s}),Hf=f(["plyForEach","plyforeach"],function(t,e,n){const s=n.fmap(r=>wt(wt(I(r),...kt(1,t-1).map(o=>e(I(r),o))))._fast(t)).squeezeJoin();return V&&(s._steps=m(t).mulmaybe(n._steps)),s}),ee=function(t,e,n=!1){return t=m(t),nt(...kt(0,t.sub(1)).map(s=>n?e.late(m(s).div(t)):e.early(m(s).div(t))))},Vf=f("iter",function(t,e){return ee(t,e,!1)},!0,!0),{iterBack:Gf,iterback:Qf}=f(["iterBack","iterback"],function(t,e){return ee(t,e,!0)},!0,!0),{repeatCycles:Uf}=f("repeatCycles",function(t,e){return new d(function(n){const s=n.span.begin.sam(),r=s.div(t).sam(),o=s.sub(r);return n=n.withSpan(i=>i.withTime(u=>u.sub(o))),e.query(n).map(i=>i.withSpan(u=>u.withTime(a=>a.add(o))))}).splitQueries()},!0,!0),ne=function(t,e,n,s=!1,r=!1){const o=Array(t-1).fill(!1);o.unshift(!0);const i=ee(t,Y(...o),!s);return r||(n=n.repeatCycles(t)),n.when(i,e)},{chunk:Kf,slowchunk:Zf,slowChunk:Xf}=f(["chunk","slowchunk","slowChunk"],function(t,e,n){return ne(t,e,n,!1,!1)},!0,!0),{chunkBack:Yf,chunkback:tp}=f(["chunkBack","chunkback"],function(t,e,n){return ne(t,e,n,!0)},!0,!0),{fastchunk:ep,fastChunk:np}=f(["fastchunk","fastChunk"],function(t,e,n){return ne(t,e,n,!1,!0)},!0,!0),{chunkinto:sp,chunkInto:rp}=f(["chunkinto","chunkInto"],function(t,e,n){return n.into($(!0,...Array(t-1).fill(!1))._iterback(t),e)}),{chunkbackinto:op,chunkBackInto:ip}=f(["chunkbackinto","chunkBackInto"],function(t,e,n){return n.into($(!0,...Array(t-1).fill(!1))._iter(t)._early(1),e)}),cp=f("bypass",function(t,e){return t=!!parseInt(t),t?B:e},!0,!0),{ribbon:up,rib:ap}=f(["ribbon","rib"],(t,e,n)=>n.early(t).restart(I(1).slow(e))),lp=f("hsla",(t,e,n,s,r)=>r.color(`hsla(${t}turn,${e*100}%,${n*100}%,${s})`)),fp=f("hsl",(t,e,n,s)=>s.color(`hsl(${t}turn,${e*100}%,${n*100}%)`));d.prototype.tag=function(t){return this.withContext(e=>({...e,tags:(e.tags||[]).concat([t])}))};const pp=f("filter",(t,e)=>e.withHaps(n=>n.filter(t))),hp=f("filterWhen",(t,e)=>e.filter(n=>t(n.whole.begin))),dp=f("within",(t,e,n,s)=>N(n(s.filterWhen(r=>r.cyclePos()>=t&&r.cyclePos()<=e)),s.filterWhen(r=>r.cyclePos()<t||r.cyclePos()>e)));d.prototype.stepJoin=function(){const t=this,e=W(...Rt(Lt(t.queryArc(0,1))))._steps,n=function(s){const o=t.early(s.span.begin.sam()).query(s.setSpan(new E(m(0),m(1))));return W(...Rt(Lt(o))).query(s)};return new d(n,e)};d.prototype.stepBind=function(t){return this.fmap(t).stepJoin()};function Rt(t){const e=t.filter((o,i)=>i.hasSteps).reduce((o,i)=>o.add(i),m(0)),n=ft(t.map((o,i)=>i._steps)).reduce((o,i)=>o.add(i),m(0)),s=e.eq(0)?void 0:n.div(e);function r(o,i){return i._steps===void 0?[o.mulmaybe(s),i]:[i._steps,i]}return t.map(o=>r(...o))}function Lt(t){const e=X(t.map(r=>[r.part.begin,r.part.end])),n=je([m(0),m(1),...e]);return Pe(n).map(r=>[r[1].sub(r[0]),N(...Ye(new E(...r),t).map(o=>o.value.withHap(i=>i.setContext(i.combineContext(o)))))])}function Ye(t,e){return ft(e.map(n=>tn(t,n)))}function tn(t,e){const n=t.intersection(e.part);if(n!=null)return new z(e.whole,n,e.value,e.context)}const en=f("pace",function(t,e){return e._steps===void 0?e:e._steps.eq(m(0))?H:e._fast(m(t).div(e._steps)).setSteps(t)});function nn(t,...e){const n=e.map(r=>$t(r));if(n.length==0)return B;t==0&&(t=n[0][1]);const s=[];for(const r of n)r[1]!=0&&(t==r[1]?s.push(r[0]):s.push(r[0]._fast(m(t).div(m(r[1])))));return N(...s)}function xt(...t){if(Array.isArray(t[0]))return nn(0,...t);if(t=t.filter(s=>s.hasSteps),t.length==0)return B;const e=it(...t.map(s=>s._steps));if(e.eq(m(0)))return H;const n=N(...t.map(s=>s.pace(e)));return n._steps=e,n}function W(...t){if(t.length===0)return H;const e=i=>Array.isArray(i)?i:[i._steps??1,i];if(t=t.map(e),t.find(i=>i[0]===void 0)){const i=t.map(a=>a[0]).filter(a=>a!==void 0);if(i.length===0)return $(...t.map(a=>a[1]));if(i.length===t.length)return H;const u=i.reduce((a,l)=>a.add(l),m(0)).div(i.length);for(let a of t)a[0]===void 0&&(a[0]=u)}if(t.length==1)return y(t[0][1]).withSteps(u=>t[0][0]);const n=t.map(i=>i[0]).reduce((i,u)=>i.add(u),m(0));let s=m(0);const r=[];for(const[i,u]of t){if(m(i).eq(0))continue;const a=s.add(i);r.push(y(u)._compress(s.div(n),a.div(n))),s=a}const o=N(...r);return o._steps=n,o}function sn(...t){t=t.map(r=>Array.isArray(r)?r.map(y):[y(r)]);const e=it(...t.map(r=>m(r.length)));let n=[];for(let r=0;r<e;++r)n.push(...t.map(o=>o.length==0?B:o[r%o.length]));n=n.filter(r=>r.hasSteps&&r._steps>0);const s=n.reduce((r,o)=>r.add(o._steps),m(0));return n=W(...n),n._steps=s,n}const rn=qt("take",function(t,e){if(!e.hasSteps||e._steps.lte(0)||(t=m(t),t.eq(0)))return H;const n=t<0;n&&(t=t.abs());const s=t.div(e._steps);return s.lte(0)?H:s.gte(1)?e:n?e.zoom(m(1).sub(s),1):e.zoom(0,s)}),on=qt("drop",function(t,e){return e.hasSteps?(t=m(t),t.lt(0)?e.take(e._steps.add(t)):e.take(m(0).sub(e._steps.sub(t)))):H}),cn=qt("extend",function(t,e){return e.fast(t).expand(t)}),un=qt("expand",function(t,e){return e.withSteps(n=>n.mul(m(t)))}),an=qt("contract",function(t,e){return e.withSteps(n=>n.div(m(t)))});d.prototype.shrinklist=function(t){const e=this;if(!e.hasSteps)return[e];let[n,s]=Array.isArray(t)?t:[t,e._steps];if(n=m(n),s===0||n===0)return[e];const r=n>0,o=[];if(r){const i=m(1).div(e._steps).mul(n);for(let u=0;u<s;++u){const a=i.mul(u);if(a.gt(1))break;o.push([a,1])}}else{n=m(0).sub(n);const i=m(1).div(e._steps).mul(n);for(let u=0;u<s;++u){const a=m(1).sub(i.mul(u));if(a.lt(0))break;o.push([m(0),a])}}return o.map(i=>e.zoom(...i))};const ln=(t,e)=>e.shrinklist(t),fn=f("shrink",function(t,e){if(!e.hasSteps)return H;const n=e.shrinklist(t),s=W(...n);return s._steps=n.reduce((r,o)=>r.add(o._steps),m(0)),s},!0,!1,t=>t.stepJoin()),mp=f("grow",function(t,e){if(!e.hasSteps)return H;const n=e.shrinklist(m(0).sub(t));n.reverse();const s=W(...n);return s._steps=n.reduce((r,o)=>r.add(o._steps),m(0)),s},!0,!1,t=>t.stepJoin()),pn=function(t,...e){return t.tour(...e)};d.prototype.tour=function(...t){return W(...[].concat(...t.map((e,n)=>[...t.slice(0,t.length-n),this,...t.slice(t.length-n)]),this,...t))};const hn=function(...t){t=t.filter(s=>s.hasSteps);const e=nt(...t.map(s=>s._slow(s._steps))),n=it(...t.map(s=>s._steps));return e._fast(n).setSteps(n)},yp=W,dn=W,wp=W,gp=sn,bp=xt;d.prototype.s_polymeter=d.prototype.polymeter;const _p=fn;d.prototype.s_taper=d.prototype.shrink;const vp=ln;d.prototype.s_taperlist=d.prototype.shrinklist;const kp=rn;d.prototype.s_add=d.prototype.take;const qp=on;d.prototype.s_sub=d.prototype.drop;const Ap=un;d.prototype.s_expand=d.prototype.expand;const Sp=cn;d.prototype.s_extend=d.prototype.extend;const Bp=an;d.prototype.s_contract=d.prototype.contract;const Tp=pn;d.prototype.s_tour=d.prototype.tour;const Cp=hn;d.prototype.s_zip=d.prototype.zip;const xp=en;d.prototype.steps=d.prototype.pace;const Op=f("chop",function(t,e){const s=Array.from({length:t},(i,u)=>u).map(i=>({begin:i/t,end:(i+1)/t})),r=function(i,u){if("begin"in i&&"end"in i&&i.begin!==void 0&&i.end!==void 0){const a=i.end-i.begin;u={begin:i.begin+u.begin*a,end:i.begin+u.end*a}}return Object.assign({},i,u)},o=function(i){return Y(s.map(u=>r(i,u)))};return e.squeezeBind(o).setSteps(V?m(t).mulmaybe(e._steps):void 0)}),zp=f("striate",function(t,e){const s=Array.from({length:t},(o,i)=>i).map(o=>({begin:o/t,end:(o+1)/t})),r=nt(...s);return e.set(r)._fast(t).setSteps(V?m(t).mulmaybe(e._steps):void 0)}),mn=function(t,e,n=.5){return e.speed(1/t*n).unit("c").slow(t)},yn=f("slice",function(t,e,n){return t.innerBind(s=>e.outerBind(r=>n.outerBind(o=>{o=o instanceof Object?o:{s:o};const i=Array.isArray(s)?s[r]:r/s,u=Array.isArray(s)?s[r+1]:(r+1)/s;return I({begin:i,end:u,_slices:s,...o})}))).setSteps(e._steps)},!1);d.prototype.onTriggerTime=function(t){return this.onTrigger((e,n,s,r)=>{const o=r-n;window.setTimeout(()=>{t(e)},o*1e3)},!1)};const Ep=f("splice",function(t,e,n){const s=yn(t,e,n);return new d(r=>{const o=r.controls._cps||1;return s.query(r).map(u=>u.withValue(a=>({speed:o/a._slices/u.whole.duration*(a.speed||1),unit:"c",...a})))}).setSteps(e._steps)},!1),{loopAt:Np,loopat:Mp}=f(["loopAt","loopat"],function(t,e){const n=e._steps?e._steps.div(t):void 0;return new d(s=>mn(t,e,s.controls._cps).query(s),n)}),Pp=f("fit",t=>t.withHaps((e,n)=>e.map(s=>s.withValue(r=>{const o=("end"in r?r.end:1)-("begin"in r?r.begin:0);return{...r,speed:(n.controls._cps||1)/s.whole.duration*o,unit:"c"}})))),{loopAtCps:Ip,loopatcps:jp}=f(["loopAtCps","loopatcps"],function(t,e,n){return mn(t,n,e)}),Jp=t=>I(1).withValue(()=>y(t())).innerJoin();let Se=t=>t<.5?1:1-(t-.5)/.5,wn=(t,e,n)=>{e=y(e),t=y(t),n=y(n);let s=e.fmap(o=>({gain:Se(o)})),r=e.fmap(o=>({gain:Se(1-o)}));return N(t.mul(s),n.mul(r))};d.prototype.xfade=function(t,e){return wn(this,t,e)};const Wp=t=>(e,n,s)=>{e=m(e).mod(n),n=m(n);const r=e.div(n),o=e.add(1).div(n);return t(s.fmap(i=>I(i)._compress(r,o)))},{beat:$p}=f(["beat"],Wp(t=>t.innerJoin())),se=(t,e,n)=>{n=m(n);const s=m(1).div(t.length),r=u=>{const a=[];for(const[l,h]of u.entries())h&&a.push([m(l).div(u.length),h]);return a},o=Ct(([u,a],[l,h])=>{const p=n.mul(l-u).add(u),k=p.add(s);return new E(p,k)},r(t),r(e));function i(u){const a=u.span.begin.sam(),l=u.span.cycleArc(),h=[];for(const p of o){const k=p.intersection(l);k!==void 0&&h.push(new z(p.withTime(_=>_.add(a)),k.withTime(_=>_.add(a)),!0))}return h}return new d(i).splitQueries()},Rp=(t,e,n)=>(t=y(t),e=y(e),n=y(n),t.innerBind(s=>e.innerBind(r=>n.innerBind(o=>se(s,r,o)))));function Ot(t){let e=Array.isArray(t);t=e?t:[t];const n=t[0],s=o=>{let i;if(typeof o=="object"&&o.value!==void 0&&(i={...o},o=o.value,delete i.value),e&&Array.isArray(o)){const u=i||{};return o.forEach((a,l)=>{l<t.length&&(u[t[l]]=a)}),u}else return i?(i[n]=o,i):{[n]:o}},r=function(o,i){return i?typeof o>"u"?i.fmap(s):i.set(y(o).withValue(s)):y(o).withValue(s)};return d.prototype[n]=function(o){return r(o,this)},r}const gt=new Map;function gn(t){return gt.has(t)}function c(t,...e){const n=Array.isArray(t)?t[0]:t;let s={};return s[n]=Ot(t),gt.set(n,n),e.forEach(r=>{s[r]=s[n],gt.set(r,n),d.prototype[r]=d.prototype[n]}),s}const{s:bn,sound:_n}=c(["s","n","gain"],"sound"),{wt:vn,wavetablePosition:kn}=c("wt","wavetablePosition"),{wtenv:qn}=c("wtenv"),{wtattack:An,wtatt:Sn}=c("wtattack","wtatt"),{wtdecay:Bn,wtdec:Tn}=c("wtdecay","wtdec"),{wtsustain:Cn,wtsus:xn}=c("wtsustain","wtsus"),{wtrelease:On,wtrel:zn}=c("wtrelease","wtrel"),{wtrate:En}=c("wtrate"),{wtsync:Nn}=c("wtsync"),{wtdepth:Mn}=c("wtdepth"),{wtshape:Pn}=c("wtshape"),{wtdc:In}=c("wtdc"),{wtskew:jn}=c("wtskew"),{warp:Jn,wavetableWarp:Wn}=c("warp","wavetableWarp"),{warpattack:$n,warpatt:Rn}=c("warpattack","warpatt"),{warpdecay:Ln,warpdec:Fn}=c("warpdecay","warpdec"),{warpsustain:Dn,warpsus:Hn}=c("warpsustain","warpsus"),{warprelease:Vn,warprel:Gn}=c("warprelease","warprel"),{warprate:Qn}=c("warprate"),{warpdepth:Un}=c("warpdepth"),{warpshape:Kn}=c("warpshape"),{warpdc:Zn}=c("warpdc"),{warpskew:Xn}=c("warpskew"),{warpmode:Yn,wavetableWarpMode:ts}=c("warpmode","wavetableWarpMode"),{wtphaserand:es,wavetablePhaseRand:ns}=c("wtphaserand","wavetablePhaseRand"),{warpenv:ss}=c("warpenv"),{warpsync:rs}=c("warpsync"),{source:os,src:is}=c("source","src"),{n:cs}=c("n"),{note:us}=c(["note","n"]),{accelerate:as}=c("accelerate"),{velocity:ls}=c("velocity"),{gain:fs}=c("gain"),{postgain:ps}=c("postgain"),{amp:hs}=c("amp"),{attack:ds,att:ms}=c("attack","att"),{fmh:ys}=c(["fmh","fmi"],"fmh"),{fmi:ws,fm:gs}=c(["fmi","fmh"],"fm"),{fmenv:bs}=c("fmenv"),{fmattack:_s}=c("fmattack"),{fmwave:vs}=c("fmwave"),{fmdecay:ks}=c("fmdecay"),{fmsustain:qs}=c("fmsustain"),{fmrelease:As}=c("fmrelease"),{fmvelocity:Ss}=c("fmvelocity"),{bank:Bs}=c("bank"),{chorus:Ts}=c("chorus"),{analyze:Cs}=c("analyze"),{fft:xs}=c("fft"),{decay:Os,dec:zs}=c("decay","dec"),{sustain:Es,sus:Ns}=c("sustain","sus"),{release:Ms,rel:Ps}=c("release","rel"),{hold:Is}=c("hold"),{bandf:js,bpf:Js,bp:Ws}=c(["bandf","bandq","bpenv"],"bpf","bp"),{bandq:$s,bpq:Rs}=c("bandq","bpq"),{begin:Ls}=c("begin"),{end:Fs}=c("end"),{loop:Ds}=c("loop"),{loopBegin:Hs,loopb:Vs}=c("loopBegin","loopb"),{loopEnd:Gs,loope:Qs}=c("loopEnd","loope"),{crush:Us}=c("crush"),{coarse:Ks}=c("coarse"),{tremolo:Zs}=c(["tremolo","tremolodepth","tremoloskew","tremolophase"],"trem"),{tremolosync:Xs}=c(["tremolosync","tremolodepth","tremoloskew","tremolophase"],"tremsync"),{tremolodepth:Ys}=c("tremolodepth","tremdepth"),{tremoloskew:tr}=c("tremoloskew","tremskew"),{tremolophase:er}=c("tremolophase","tremphase"),{tremoloshape:nr}=c("tremoloshape","tremshape"),{drive:sr}=c("drive"),{duck:rr}=c("duckorbit","duck"),{duckdepth:or}=c("duckdepth"),{duckonset:ir}=c("duckonset","duckons"),{duckattack:cr}=c("duckattack","duckatt"),{byteBeatExpression:ur,bbexpr:ar}=c("byteBeatExpression","bbexpr"),{byteBeatStartTime:lr,bbst:fr}=c("byteBeatStartTime","bbst"),{channels:pr,ch:hr}=c("channels","ch"),{pw:dr}=c(["pw","pwrate","pwsweep"]),{pwrate:mr}=c("pwrate"),{pwsweep:yr}=c("pwsweep"),{phaserrate:wr,ph:gr,phaser:br}=c(["phaserrate","phaserdepth","phasercenter","phasersweep"],"ph","phaser"),{phasersweep:_r,phs:vr}=c("phasersweep","phs"),{phasercenter:kr,phc:qr}=c("phasercenter","phc"),{phaserdepth:Ar,phd:Sr,phasdp:Br}=c("phaserdepth","phd","phasdp"),{channel:Tr}=c("channel"),{cut:Cr}=c("cut"),{cutoff:xr,ctf:Or,lpf:zr,lp:Er}=c(["cutoff","resonance","lpenv"],"ctf","lpf","lp"),{lpenv:Nr,lpe:Mr}=c("lpenv","lpe"),{hpenv:Pr,hpe:Ir}=c("hpenv","hpe"),{bpenv:jr,bpe:Jr}=c("bpenv","bpe"),{lpattack:Wr,lpa:$r}=c("lpattack","lpa"),{hpattack:Rr,hpa:Lr}=c("hpattack","hpa"),{bpattack:Fr,bpa:Dr}=c("bpattack","bpa"),{lpdecay:Hr,lpd:Vr}=c("lpdecay","lpd"),{hpdecay:Gr,hpd:Qr}=c("hpdecay","hpd"),{bpdecay:Ur,bpd:Kr}=c("bpdecay","bpd"),{lpsustain:Zr,lps:Xr}=c("lpsustain","lps"),{hpsustain:Yr,hps:to}=c("hpsustain","hps"),{bpsustain:eo,bps:no}=c("bpsustain","bps"),{lprelease:so,lpr:ro}=c("lprelease","lpr"),{hprelease:oo,hpr:io}=c("hprelease","hpr"),{bprelease:co,bpr:uo}=c("bprelease","bpr"),{ftype:ao}=c("ftype"),{fanchor:lo}=c("fanchor"),{vib:fo,vibrato:po,v:ho}=c(["vib","vibmod"],"vibrato","v"),{noise:mo}=c("noise"),{vibmod:yo,vmod:wo}=c(["vibmod","vib"],"vmod"),{hcutoff:go,hpf:bo,hp:_o}=c(["hcutoff","hresonance","hpenv"],"hpf","hp"),{hresonance:vo,hpq:ko}=c("hresonance","hpq"),{resonance:qo,lpq:Ao}=c("resonance","lpq"),{djf:So}=c("djf"),{delay:Bo}=c(["delay","delaytime","delayfeedback"]),{delayfeedback:To,delayfb:Co,dfb:xo}=c("delayfeedback","delayfb","dfb"),{delayspeed:Oo}=c("delayspeed"),{delaytime:zo,delayt:Eo,dt:No}=c("delaytime","delayt","dt"),{delaysync:Mo}=c("delaysync"),{lock:Po}=c("lock"),{detune:Io,det:jo}=c("detune","det"),{unison:Jo}=c("unison"),{spread:Wo}=c("spread"),{dry:$o}=c("dry"),{fadeTime:Ro,fadeOutTime:Lo}=c("fadeTime","fadeOutTime"),{fadeInTime:Fo}=c("fadeInTime"),{freq:Do}=c("freq"),{pattack:Ho,patt:Vo}=c("pattack","patt"),{pdecay:Go,pdec:Qo}=c("pdecay","pdec"),{psustain:Uo,psus:Ko}=c("psustain","psus"),{prelease:Zo,prel:Xo}=c("prelease","prel"),{penv:Yo}=c("penv"),{pcurve:ti}=c("pcurve"),{panchor:ei}=c("panchor"),{gate:ni,gat:si}=c("gate","gat"),{leslie:ri}=c("leslie"),{lrate:oi}=c("lrate"),{lsize:ii}=c("lsize"),{activeLabel:ci}=c("activeLabel"),{label:ui}=c(["label","activeLabel"]),{degree:ai}=c("degree"),{mtranspose:li}=c("mtranspose"),{ctranspose:fi}=c("ctranspose"),{harmonic:pi}=c("harmonic"),{stepsPerOctave:hi}=c("stepsPerOctave"),{octaveR:di}=c("octaveR"),{nudge:mi}=c("nudge"),{octave:yi}=c("octave"),{orbit:wi}=c("orbit"),{overgain:gi}=c("overgain"),{overshape:bi}=c("overshape"),{pan:_i}=c("pan"),{panspan:vi}=c("panspan"),{pansplay:ki}=c("pansplay"),{panwidth:qi}=c("panwidth"),{panorient:Ai}=c("panorient"),{rate:Si}=c("rate"),{slide:Bi}=c("slide"),{semitone:Ti}=c("semitone"),{voice:Ci}=c("voice"),{chord:xi}=c("chord"),{dictionary:Oi,dict:zi}=c("dictionary","dict"),{anchor:Ei}=c("anchor"),{offset:Ni}=c("offset"),{octaves:Mi}=c("octaves"),{mode:Pi}=c(["mode","anchor"]),{room:Ii}=c(["room","size"]),{roomlp:ji,rlp:Ji}=c("roomlp","rlp"),{roomdim:Wi,rdim:$i}=c("roomdim","rdim"),{roomfade:Ri,rfade:Li}=c("roomfade","rfade"),{ir:Fi,iresponse:Di}=c(["ir","i"],"iresponse"),{irspeed:Hi}=c("irspeed"),{irbegin:Vi}=c("irbegin"),{roomsize:Gi,size:Qi,sz:Ui,rsize:Ki}=c("roomsize","size","sz","rsize"),{shape:Zi}=c(["shape","shapevol"]),{distort:Xi,dist:Yi}=c(["distort","distortvol"],"dist"),{compressor:tc}=c(["compressor","compressorRatio","compressorKnee","compressorAttack","compressorRelease"]),{compressorKnee:ec}=c("compressorKnee"),{compressorRatio:nc}=c("compressorRatio"),{compressorAttack:sc}=c("compressorAttack"),{compressorRelease:rc}=c("compressorRelease"),{speed:re}=c("speed"),{stretch:oc}=c("stretch"),{unit:ic}=c("unit"),{squiz:cc}=c("squiz"),{vowel:uc}=c("vowel"),{waveloss:ac}=c("waveloss"),{density:Lp}=c("density"),{expression:lc}=c("expression"),{sustainpedal:fc}=c("sustainpedal"),{fshift:pc}=c("fshift"),{fshiftnote:hc}=c("fshiftnote"),{fshiftphase:dc}=c("fshiftphase"),{triode:mc}=c("triode"),{krush:yc}=c("krush"),{kcutoff:wc}=c("kcutoff"),{octer:gc}=c("octer"),{octersub:bc}=c("octersub"),{octersubsub:_c}=c("octersubsub"),{ring:vc}=c("ring"),{ringf:kc}=c("ringf"),{ringdf:qc}=c("ringdf"),{freeze:Ac}=c("freeze"),{xsdelay:Sc}=c("xsdelay"),{tsdelay:Bc}=c("tsdelay"),{real:Tc}=c("real"),{imag:Cc}=c("imag"),{enhance:xc}=c("enhance"),{partials:Oc}=c("partials"),{comb:zc}=c("comb"),{smear:Ec}=c("smear"),{scram:Nc}=c("scram"),{binshift:Mc}=c("binshift"),{hbrick:Pc}=c("hbrick"),{lbrick:Ic}=c("lbrick"),{frameRate:jc}=c("frameRate"),{frames:Jc}=c("frames"),{hours:Wc}=c("hours"),{minutes:$c}=c("minutes"),{seconds:Rc}=c("seconds"),{songPtr:Lc}=c("songPtr"),{uid:Fc}=c("uid"),{val:Dc}=c("val"),{cps:Hc}=c("cps"),{clip:Vc,legato:Gc}=c("clip","legato"),{duration:Qc,dur:Uc}=c("duration","dur"),{zrand:Kc}=c("zrand"),{curve:Zc}=c("curve"),{deltaSlide:Xc}=c("deltaSlide"),{pitchJump:Yc}=c("pitchJump"),{pitchJumpTime:tu}=c("pitchJumpTime"),{lfo:eu,repeatTime:nu}=c("lfo","repeatTime"),{znoise:su}=c("znoise"),{zmod:ru}=c("zmod"),{zcrush:ou}=c("zcrush"),{zdelay:iu}=c("zdelay"),{zzfx:cu}=c("zzfx"),{color:uu,colour:au}=c(["color","colour"]);let lu=(...t)=>t.reduce((e,n)=>Object.assign(e,{[n]:Ot(n)}),{});const fu=f("adsr",(t,e)=>{t=Array.isArray(t)?t:[t];const[n,s,r,o]=t;return e.set({attack:n,decay:s,sustain:r,release:o})}),pu=f("ad",(t,e)=>{t=Array.isArray(t)?t:[t];const[n,s=n]=t;return e.attack(n).decay(s)}),hu=f("ds",(t,e)=>{t=Array.isArray(t)?t:[t];const[n,s=0]=t;return e.set({decay:n,sustain:s})}),du=f("ar",(t,e)=>{t=Array.isArray(t)?t:[t];const[n,s=n]=t;return e.set({attack:n,release:s})}),{midichan:mu}=c("midichan"),{midimap:yu}=c("midimap"),{midiport:wu}=c("midiport"),{midicmd:gu}=c("midicmd"),bu=f("control",(t,e)=>{if(!Array.isArray(t))throw new Error("control expects an array of [ccn, ccv]");const[n,s]=t;return e.ccn(n).ccv(s)}),{ccn:_u}=c("ccn"),{ccv:vu}=c("ccv"),{ctlNum:ku}=c("ctlNum"),{nrpnn:qu}=c("nrpnn"),{nrpv:Au}=c("nrpv"),{progNum:Su}=c("progNum"),Bu=f("sysex",(t,e)=>{if(!Array.isArray(t))throw new Error("sysex expects an array of [id, data]");const[n,s]=t;return e.sysexid(n).sysexdata(s)}),{sysexid:Tu}=c("sysexid"),{sysexdata:Cu}=c("sysexdata"),{midibend:xu}=c("midibend"),{miditouch:Ou}=c("miditouch"),{polyTouch:zu}=c("polyTouch"),oe=t=>gt.has(t)?gt.get(t):t,Eu=f("as",(t,e)=>(t=Array.isArray(t)?t:[t],e.fmap(n=>(n=Array.isArray(n)?n:[n],n=Object.fromEntries(t.map((s,r)=>[oe(s),n[r]])),n)))),Nu=f("scrub",(t,e)=>t.outerBind(n=>{Array.isArray(n)||(n=[n]);const[s,r=1]=n;return e.begin(s).mul(re(r)).clip(1)}),!1),Fp=Object.freeze(Object.defineProperty({__proto__:null,accelerate:as,activeLabel:ci,ad:pu,adsr:fu,amp:hs,analyze:Cs,anchor:Ei,ar:du,as:Eu,att:ms,attack:ds,bandf:js,bandq:$s,bank:Bs,bbexpr:ar,bbst:fr,begin:Ls,binshift:Mc,bp:Ws,bpa:Dr,bpattack:Fr,bpd:Kr,bpdecay:Ur,bpe:Jr,bpenv:jr,bpf:Js,bpq:Rs,bpr:uo,bprelease:co,bps:no,bpsustain:eo,byteBeatExpression:ur,byteBeatStartTime:lr,ccn:_u,ccv:vu,ch:hr,channel:Tr,channels:pr,chord:xi,chorus:Ts,clip:Vc,coarse:Ks,color:uu,colour:au,comb:zc,compressor:tc,compressorAttack:sc,compressorKnee:ec,compressorRatio:nc,compressorRelease:rc,control:bu,cps:Hc,createParam:Ot,createParams:lu,crush:Us,ctf:Or,ctlNum:ku,ctranspose:fi,curve:Zc,cut:Cr,cutoff:xr,dec:zs,decay:Os,degree:ai,delay:Bo,delayfb:Co,delayfeedback:To,delayspeed:Oo,delaysync:Mo,delayt:Eo,delaytime:zo,deltaSlide:Xc,density:Lp,det:jo,detune:Io,dfb:xo,dict:zi,dictionary:Oi,dist:Yi,distort:Xi,djf:So,drive:sr,dry:$o,ds:hu,dt:No,duck:rr,duckattack:cr,duckdepth:or,duckonset:ir,dur:Uc,duration:Qc,end:Fs,enhance:xc,expression:lc,fadeInTime:Fo,fadeOutTime:Lo,fadeTime:Ro,fanchor:lo,fft:xs,fm:gs,fmattack:_s,fmdecay:ks,fmenv:bs,fmh:ys,fmi:ws,fmrelease:As,fmsustain:qs,fmvelocity:Ss,fmwave:vs,frameRate:jc,frames:Jc,freeze:Ac,freq:Do,fshift:pc,fshiftnote:hc,fshiftphase:dc,ftype:ao,gain:fs,gat:si,gate:ni,getControlName:oe,harmonic:pi,hbrick:Pc,hcutoff:go,hold:Is,hours:Wc,hp:_o,hpa:Lr,hpattack:Rr,hpd:Qr,hpdecay:Gr,hpe:Ir,hpenv:Pr,hpf:bo,hpq:ko,hpr:io,hprelease:oo,hps:to,hpsustain:Yr,hresonance:vo,imag:Cc,ir:Fi,irbegin:Vi,iresponse:Di,irspeed:Hi,isControlName:gn,kcutoff:wc,krush:yc,label:ui,lbrick:Ic,legato:Gc,leslie:ri,lfo:eu,lock:Po,loop:Ds,loopBegin:Hs,loopEnd:Gs,loopb:Vs,loope:Qs,lp:Er,lpa:$r,lpattack:Wr,lpd:Vr,lpdecay:Hr,lpe:Mr,lpenv:Nr,lpf:zr,lpq:Ao,lpr:ro,lprelease:so,lps:Xr,lpsustain:Zr,lrate:oi,lsize:ii,midibend:xu,midichan:mu,midicmd:gu,midimap:yu,midiport:wu,miditouch:Ou,minutes:$c,mode:Pi,mtranspose:li,n:cs,noise:mo,note:us,nrpnn:qu,nrpv:Au,nudge:mi,octave:yi,octaveR:di,octaves:Mi,octer:gc,octersub:bc,octersubsub:_c,offset:Ni,orbit:wi,overgain:gi,overshape:bi,pan:_i,panchor:ei,panorient:Ai,panspan:vi,pansplay:ki,panwidth:qi,partials:Oc,patt:Vo,pattack:Ho,pcurve:ti,pdec:Qo,pdecay:Go,penv:Yo,ph:gr,phasdp:Br,phaser:br,phasercenter:kr,phaserdepth:Ar,phaserrate:wr,phasersweep:_r,phc:qr,phd:Sr,phs:vr,pitchJump:Yc,pitchJumpTime:tu,polyTouch:zu,postgain:ps,prel:Xo,prelease:Zo,progNum:Su,psus:Ko,psustain:Uo,pw:dr,pwrate:mr,pwsweep:yr,rate:Si,rdim:$i,real:Tc,registerControl:c,rel:Ps,release:Ms,repeatTime:nu,resonance:qo,rfade:Li,ring:vc,ringdf:qc,ringf:kc,rlp:Ji,room:Ii,roomdim:Wi,roomfade:Ri,roomlp:ji,roomsize:Gi,rsize:Ki,s:bn,scram:Nc,scrub:Nu,seconds:Rc,semitone:Ti,shape:Zi,size:Qi,slide:Bi,smear:Ec,songPtr:Lc,sound:_n,source:os,speed:re,spread:Wo,squiz:cc,src:is,stepsPerOctave:hi,stretch:oc,sus:Ns,sustain:Es,sustainpedal:fc,sysex:Bu,sysexdata:Cu,sysexid:Tu,sz:Ui,tremolo:Zs,tremolodepth:Ys,tremolophase:er,tremoloshape:nr,tremoloskew:tr,tremolosync:Xs,triode:mc,tsdelay:Bc,uid:Fc,unison:Jo,unit:ic,v:ho,val:Dc,velocity:ls,vib:fo,vibmod:yo,vibrato:po,vmod:wo,voice:Ci,vowel:uc,warp:Jn,warpatt:Rn,warpattack:$n,warpdc:Zn,warpdec:Fn,warpdecay:Ln,warpdepth:Un,warpenv:ss,warpmode:Yn,warprate:Qn,warprel:Gn,warprelease:Vn,warpshape:Kn,warpskew:Xn,warpsus:Hn,warpsustain:Dn,warpsync:rs,waveloss:ac,wavetablePhaseRand:ns,wavetablePosition:kn,wavetableWarp:Wn,wavetableWarpMode:ts,wt:vn,wtatt:Sn,wtattack:An,wtdc:In,wtdec:Tn,wtdecay:Bn,wtdepth:Mn,wtenv:qn,wtphaserand:es,wtrate:En,wtrel:zn,wtrelease:On,wtshape:Pn,wtskew:jn,wtsus:xn,wtsustain:Cn,wtsync:Nn,xsdelay:Sc,zcrush:ou,zdelay:iu,zmod:ru,znoise:su,zrand:Kc,zzfx:cu},Symbol.toStringTag,{value:"Module"})),Dp=function(t,e){const[n,s]=t,[r,o]=e,[i,u]=Kt(s,r);return[[s,n-s],[Ct((a,l)=>a.concat(l),i,o),u]]},Hp=function(t,e){const[n,s]=t,[r,o]=e,[i,u]=Kt(n,o);return[[n,s-n],[Ct((l,h)=>l.concat(h),r,i),u]]},Mu=function(t,e){const[n,s]=t;return Math.min(n,s)<=1?[t,e]:Mu(...n>s?Dp(t,e):Hp(t,e))},ie=function(t,e){const n=t<0,s=Math.abs(t),r=e-s,o=Array(s).fill([1]),i=Array(r).fill([0]),u=Mu([s,r],[o,i]),a=X(u[1][0]).concat(X(u[1][1]));return n?a.map(l=>1-l):a},zt=function(t,e,n){const s=ie(t,e);return n?Ee(s,-n):s},Vp=f("euclid",function(t,e,n){return n.struct(zt(t,e,0))}),Gp=f("e",function(t,e){Array.isArray(t)||(t=[t]);const[n,s=n,r=0]=t;return e.struct(zt(n,s,r))}),{euclidrot:Qp,euclidRot:Up}=f(["euclidrot","euclidRot"],function(t,e,n,s){return s.struct(zt(t,e,n))}),Pu=function(t,e,n,s){if(t<1)return B;const o=zt(t,e,0).join("").split("1").slice(1).map(i=>[i.length+1,!0]);return s.struct(dn(...o)).late(m(n).div(e))},Kp=f(["euclidLegato"],function(t,e,n){return Pu(t,e,0,n)}),Zp=f(["euclidLegatoRot"],function(t,e,n,s){return Pu(t,e,n,s)}),{euclidish:Xp,eish:Yp}=f(["euclidish","eish"],function(t,e,n,s){const r=se(ie(t,e),new Array(t).fill(1),n);return s.struct(r).setSteps(e)});function Iu(t,e,n=.05,s=.1,r=.1,o=globalThis.setInterval,i=globalThis.clearInterval,u=!0){let a=0,l=0,h=10**4,p=.01;const k=F=>n=F(n);r=r||s/2;const _=()=>{const F=t(),st=F+s+r;for(l===0&&(l=F+p);l<st;)l=u?Math.round(l*h)/h:l,e(l,n,a,F),l+=n,a++};let A;const C=()=>{R(),_(),A=o(_,s*1e3)},R=()=>{A!==void 0&&i(A),A=void 0};return{setDuration:k,start:C,stop:()=>{a=0,l=0,R()},pause:()=>R(),duration:n,interval:s,getPhase:()=>l,minLatency:p}}function th(t){return new d(e=>[new z(void 0,e.span,t)])}const Q=t=>{const e=n=>[new z(void 0,n.span,t(n.span.begin))];return new d(e)},At=Q(t=>t%1),ce=At.toBipolar(),Et=Q(t=>1-t%1),ue=Et.toBipolar(),ae=Q(t=>Math.sin(Math.PI*2*t)),ju=ae.fromBipolar(),eh=ju._early(m(1).div(4)),nh=ae._early(m(1).div(4)),Ju=Q(t=>Math.floor(t*2%2)),sh=Ju.toBipolar(),rh=$(At,Et),oh=$(ce,ue),ih=$(Et,At),ch=$(ue,ce),le=Q(ut);let fe=0,pe=0;typeof window<"u"&&document.addEventListener("mousemove",t=>{fe=t.clientY/document.body.clientHeight,pe=t.clientX/document.body.clientWidth});const uh=Q(()=>fe),ah=Q(()=>fe),lh=Q(()=>pe),fh=Q(()=>pe),Wu=t=>{const e=t<<13^t,n=e>>17^e;return n<<5^n},ph=t=>t-Math.trunc(t),$u=t=>Wu(Math.trunc(ph(t/300)*536870912)),Ru=t=>t%536870912/536870912,bt=t=>Math.abs(Ru($u(t))),hh=(t,e)=>{const n=[];for(let s=0;s<e;++s)n.push(Ru(t)),t=Wu(t);return n},dh=(t,e)=>hh($u(t),e),Lu=t=>At.range(0,t).round().segment(t),mh=t=>{const e=y(t).log2(0).floor().add(1);return Fu(t,e)},Fu=(t,e=16)=>{e=y(e);const n=Lu(e).mul(-1).add(e.sub(1));return y(t).segment(e).brshift(n).band(I(1))},Du=t=>Q(e=>{const s=dh(e.floor().add(.5),t).map((o,i)=>[o,i]).sort((o,i)=>(o[0]>i[0])-(o[0]<i[0])).map(o=>o[1]),r=e.cyclePos().mul(t).floor()%t;return s[r]})._segment(t),Hu=(t,e,n)=>{const s=[...Array(e).keys()].map(r=>n.zoom(m(r).div(e),m(r+1).div(e)));return t.fmap(r=>s[r].repeatCycles(e)._fast(e)).innerJoin()},yh=f("shuffle",(t,e)=>Hu(Du(t),t,e)),wh=f("scramble",(t,e)=>Hu(de(t)._segment(t),t,e)),G=Q(bt),gh=G.toBipolar(),he=t=>G.fmap(e=>e<t),bh=t=>y(t).fmap(he).innerJoin(),_h=he(.5),de=t=>G.fmap(e=>Math.trunc(e*t)),vh=t=>y(t).fmap(de).innerJoin(),me=(t,e)=>(e=e.map(y),e.length==0?B:t.range(0,e.length).fmap(n=>{const s=Math.min(Math.max(Math.floor(n),0),e.length-1);return e[s]})),Nt=(t,e)=>me(t,e).outerJoin(),ye=(t,e)=>me(t,e).innerJoin(),Vu=(...t)=>Nt(G,t),kh=(...t)=>ye(G,t),qh=Vu;d.prototype.choose=function(...t){return Nt(this,t)};d.prototype.choose2=function(...t){return Nt(this.fromBipolar(),t)};const Gu=(...t)=>ye(G.segment(1),t),Ah=Gu,Qu=function(t,...e){const n=e.map(u=>y(u[0])),s=[];let r=I(0);for(const u of e)r=r.add(u[1]),s.push(r);const o=He(s),i=function(u){const a=r.mul(u);return o.fmap(l=>h=>n[l.findIndex(p=>p>h,l)]).appLeft(a)};return t.bind(i)},Sh=(...t)=>Qu(...t).outerJoin(),Bh=(...t)=>Sh(G,...t),Uu=(...t)=>Qu(G.segment(1),...t).innerJoin(),Th=Uu;function Ch(t){let e=Math.floor(t),n=e+1;const s=i=>6*i**5-15*i**4+10*i**3;return(i=>u=>a=>u+s(i)*(a-u))(t-e)(bt(e))(bt(n))}const Ku=t=>t.fmap(Ch);function xh(t){const e=Math.floor(t),n=e+1,s=bt(e),r=bt(n)+s,o=(t-e)/(n-e);return((u,a,l)=>u+(a-u)*l)(s,r,o)/2}const Zu=t=>t.fmap(xh),Oh=Ku(le.fmap(t=>Number(t))),zh=Zu(le.fmap(t=>Number(t))),Eh=f("degradeByWith",(t,e,n)=>n.fmap(s=>r=>s).appLeft(t.filterValues(s=>s>e)),!0,!0),Nh=f("degradeBy",function(t,e){return e._degradeByWith(G,t)},!0,!0),Mh=f("degrade",t=>t._degradeBy(.5),!0,!0),Ph=f("undegradeBy",function(t,e){return e._degradeByWith(G.fmap(n=>1-n),t)},!0,!0),Ih=f("undegrade",t=>t._undegradeBy(.5),!0,!0),jh=f("sometimesBy",function(t,e,n){return y(t).fmap(s=>N(n._degradeBy(s),e(n._undegradeBy(1-s)))).innerJoin()}),Jh=f("sometimes",function(t,e){return e._sometimesBy(.5,t)}),Wh=f("someCyclesBy",function(t,e,n){return y(t).fmap(s=>N(n._degradeByWith(G._segment(1),s),e(n._degradeByWith(G.fmap(r=>1-r)._segment(1),1-s)))).innerJoin()}),$h=f("someCycles",function(t,e){return e._someCyclesBy(.5,t)}),Rh=f("often",function(t,e){return e.sometimesBy(.75,t)}),Lh=f("rarely",function(t,e){return e.sometimesBy(.25,t)}),Fh=f("almostNever",function(t,e){return e.sometimesBy(.1,t)}),Dh=f("almostAlways",function(t,e){return e.sometimesBy(.9,t)}),Hh=f("never",function(t,e){return e}),Vh=f("always",function(t,e){return t(e)});function we(t){Array.isArray(t)===!1&&(t=[t]);const e=Fe();return t.every(n=>{const s=Le.get(n)??n;return e[s]})}const Gh=f("whenKey",function(t,e,n){return n.when(we(t),e)}),Qh=f("keyDown",function(t){return t.fmap(we)}),K=function(t,e,n=!0){const s=Array.isArray(t),r=Object.keys(t).length;return t=$e(t,y),r===0?B:e.fmap(o=>{let i=o;return s&&(i=n?Math.round(i)%r:Ie(Math.round(i),0,t.length-1)),t[i]})},Xu=function(t,e){return Array.isArray(e)&&([e,t]=[t,e]),Uh(t,e)},Uh=f("pick",function(t,e){return K(t,e,!1).innerJoin()}),Yu=f("pickmod",function(t,e){return K(t,e,!0).innerJoin()}),Kh=f("pickF",function(t,e,n){return n.apply(Xu(t,e))}),Zh=f("pickmodF",function(t,e,n){return n.apply(Yu(t,e))}),Xh=f("pickOut",function(t,e){return K(t,e,!1).outerJoin()}),Yh=f("pickmodOut",function(t,e){return K(t,e,!0).outerJoin()}),td=f("pickRestart",function(t,e){return K(t,e,!1).restartJoin()}),ed=f("pickmodRestart",function(t,e){return K(t,e,!0).restartJoin()}),nd=f("pickReset",function(t,e){return K(t,e,!1).resetJoin()}),sd=f("pickmodReset",function(t,e){return K(t,e,!0).resetJoin()}),{inhabit:rd,pickSqueeze:od}=f(["inhabit","pickSqueeze"],function(t,e){return K(t,e,!1).squeezeJoin()}),{inhabitmod:id,pickmodSqueeze:cd}=f(["inhabitmod","pickmodSqueeze"],function(t,e){return K(t,e,!0).squeezeJoin()}),ud=(t,e)=>(e=e.map(y),e.length==0?B:t.fmap(n=>{const s=vt(Math.round(n),e.length);return e[s]}).squeezeJoin());let Bt;try{Bt=window?.speechSynthesis}catch{console.warn("cannot use window: not in browser?")}let Be=Bt?.getVoices();function ad(t,e,n){Bt.cancel();const s=new SpeechSynthesisUtterance(t);s.lang=e,Be=Bt.getVoices();const r=Be.filter(o=>o.lang.includes(e));typeof n=="number"?s.voice=r[n%r.length]:typeof n=="string"&&(s.voice=r.find(o=>o.name===o)),speechSynthesis.speak(s)}const ld=f("speak",function(t,e,n){return n.onTrigger(s=>{ad(s.value,t,e)})}),ta={},ea=async(...t)=>{const e=await Promise.allSettled(t),n=e.filter(s=>s.status==="fulfilled").map(s=>s.value);return e.forEach((s,r)=>{s.status==="rejected"&&console.warn(`evalScope: module with index ${r} could not be loaded:`,s.reason)}),n.forEach(s=>{Object.entries(s).forEach(([r,o])=>{globalThis[r]=o,ta[r]=o})}),n};function fd(t,e={}){const{wrapExpression:n=!0,wrapAsync:s=!0}=e;n&&(t=`{${t}}`),s&&(t=`(async ()=>${t})()`);const r=`"use strict";return (${t})`;return Function(r)()}const na=async(t,e,n)=>{let s={};if(e){const i=e(t,n);t=i.output,s=i}return{mode:"javascript",pattern:await fd(t,{wrapExpression:!!e}),meta:s}};class pd{constructor({onTrigger:e,onToggle:n,getTime:s}){this.started=!1,this.cps=.5,this.getTime=s,this.time_at_last_tick_message=0,this.collator=new Re({getTargetClockTime:s}),this.onToggle=n,this.latency=.1,this.cycle=0,this.id=Math.round(Date.now()*Math.random()),this.worker=new SharedWorker(new URL("/_astro/clockworker-ZDiUtESR.js",import.meta.url)),this.worker.port.start(),this.channel=new BroadcastChannel("strudeltick");const r=i=>{const{cps:u,begin:a,end:l,cycle:h,time:p}=i;this.cps=u,this.cycle=h;const k=this.collator.calculateOffset(p)+p;o(a,l,k),this.time_at_last_tick_message=k},o=(i,u,a)=>{if(this.started===!1)return;this.pattern.queryArc(i,u,{_cps:this.cps}).forEach(h=>{if(h.hasOnset()){const k=Jt(h.whole.begin-this.cycle,this.cps)+a+this.latency,_=Jt(h.duration,this.cps);e?.(h,0,_,this.cps,k)}})};this.channel.onmessage=i=>{if(!this.started)return;const{payload:u,type:a}=i.data;switch(a){case"tick":r(u)}}}sendMessage(e,n){this.worker.port.postMessage({type:e,payload:n,id:this.id})}now(){const e=(this.getTime()-this.time_at_last_tick_message)*this.cps;return this.cycle+e}setCps(e=1){this.sendMessage("cpschange",{cps:e})}setCycle(e){this.sendMessage("setcycle",{cycle:e})}setStarted(e){this.sendMessage("toggle",{started:e}),this.started=e,this.onToggle?.(e)}start(){j("[cyclist] start"),this.setStarted(!0)}stop(){j("[cyclist] stop"),this.collator.reset(),this.setStarted(!1)}setPattern(e,n=!1){this.pattern=e,n&&!this.started&&this.start()}log(e,n,s){const r=s.filter(o=>o.hasOnset());console.log(`${e.toFixed(4)} - ${n.toFixed(4)} ${Array(r.length).fill("I").join("")}`)}}class sa{constructor({interval:e,onTrigger:n,onToggle:s,onError:r,getTime:o,latency:i=.1,setInterval:u,clearInterval:a,beforeStart:l}){this.started=!1,this.beforeStart=l,this.cps=.5,this.num_ticks_since_cps_change=0,this.lastTick=0,this.lastBegin=0,this.lastEnd=0,this.getTime=o,this.num_cycles_at_cps_change=0,this.seconds_at_cps_change,this.onToggle=s,this.latency=i,this.clock=Iu(o,(h,p,k,_)=>{this.num_ticks_since_cps_change===0&&(this.num_cycles_at_cps_change=this.lastEnd,this.seconds_at_cps_change=h),this.num_ticks_since_cps_change++;const C=this.num_ticks_since_cps_change*p*this.cps;try{const R=this.lastEnd;this.lastBegin=R;const L=this.num_cycles_at_cps_change+C;if(this.lastEnd=L,this.lastTick=h,h<_){console.log("skip query: too late");return}this.pattern.queryArc(R,L,{_cps:this.cps}).forEach(O=>{if(O.hasOnset()){const F=(O.whole.begin-this.num_cycles_at_cps_change)/this.cps+this.seconds_at_cps_change+i,st=O.duration/this.cps,tt=F-h;n?.(O,tt,st,this.cps,F),O.value.cps!==void 0&&this.cps!=O.value.cps&&(this.cps=O.value.cps,this.num_ticks_since_cps_change=0)}})}catch(R){Gt(R),r?.(R)}},e,.1,.1,u,a)}now(){if(!this.started)return 0;const e=this.getTime()-this.lastTick-this.clock.duration;return this.lastBegin+e*this.cps}setStarted(e){this.started=e,this.onToggle?.(e)}async start(){if(await this.beforeStart?.(),this.num_ticks_since_cps_change=0,this.num_cycles_at_cps_change=0,!this.pattern)throw new Error("Scheduler: no pattern set! call .setPattern first.");j("[cyclist] start"),this.clock.start(),this.setStarted(!0)}pause(){j("[cyclist] pause"),this.clock.pause(),this.setStarted(!1)}stop(){j("[cyclist] stop"),this.clock.stop(),this.lastEnd=0,this.setStarted(!1)}async setPattern(e,n=!1){this.pattern=e,n&&!this.started&&await this.start()}setCps(e=.5){this.cps!==e&&(this.cps=e,this.num_ticks_since_cps_change=0)}log(e,n,s){const r=s.filter(o=>o.hasOnset());console.log(`${e.toFixed(4)} - ${n.toFixed(4)} ${Array(r.length).fill("I").join("")}`)}}let Ft;function hd(){if(!Ft)throw new Error("no time set! use setTime to define a time source");return Ft()}function Dt(t){Ft=t}function dd({defaultOutput:t,onEvalError:e,beforeEval:n,beforeStart:s,afterEval:r,getTime:o,transpiler:i,onToggle:u,editPattern:a,onUpdateState:l,sync:h=!1,setInterval:p,clearInterval:k,id:_,mondo:A=!1}){const C={schedulerError:void 0,evalError:void 0,code:"// LOADING",activeCode:"// LOADING",pattern:void 0,miniLocations:[],widgets:[],pending:!1,started:!1},R={id:_},L=q=>{Object.assign(C,q),C.isDirty=C.code!==C.activeCode,C.error=C.evalError||C.schedulerError,l?.(C)},ht={onTrigger:ra({defaultOutput:t,getTime:o}),getTime:o,onToggle:q=>{L({started:q}),u?.(q)},setInterval:p,clearInterval:k,beforeStart:s},O=h&&typeof SharedWorker<"u"?new pd(ht):new sa(ht);let F={},st=0,tt;const ge=function(){return F={},st=0,tt=void 0,B};function be(q){return q._Pattern?q.__pure:q}const _e=async(q,x=!0)=>(q=a?.(q)||q,await O.setPattern(q,x),q);Dt(()=>O.now());const oa=()=>O.stop(),ia=()=>O.start(),ca=()=>O.pause(),ua=()=>O.toggle(),Mt=q=>(O.setCps(be(q)),B),ve=q=>(O.setCps(be(q)/60),B);let dt=[];const aa=function(q){return dt.push(q),B},la=function(q){return tt=q,B},fa=()=>{d.prototype.p=function(x){return typeof x=="string"&&(x.startsWith("_")||x.endsWith("_"))?B:(x==="$"&&(x=`$${st}`,st++),F[x]=this,this)},d.prototype.q=function(x){return B};try{for(let x=1;x<10;++x)Object.defineProperty(d.prototype,`d${x}`,{get(){return this.p(x)},configurable:!0}),Object.defineProperty(d.prototype,`p${x}`,{get(){return this.p(x)},configurable:!0}),d.prototype[`q${x}`]=B}catch(x){console.warn("injectPatternMethods: error:",x)}const q=f("cpm",function(x,Pt){return Pt._fast(x/60/O.cps)});return ea({all:aa,each:la,hush:ge,cpm:q,setCps:Mt,setcps:Mt,setCpm:ve,setcpm:ve})};return{scheduler:O,evaluate:async(q,x=!0,Pt=!0)=>{if(!q)throw new Error("no code to evaluate");try{L({code:q,pending:!0}),await fa(),Dt(()=>O.now()),await n?.({code:q}),dt=[],Pt&&ge(),A&&(q=`mondolang\`${q}\``);let{pattern:P,meta:It}=await na(q,i,R);if(Object.keys(F).length){let rt=Object.values(F);tt&&(rt=rt.map(pa=>tt(pa))),P=N(...rt)}else tt&&(P=tt(P));if(dt.length)for(let rt in dt)P=dt[rt](P);if(!Xt(P)){const rt=`got "${typeof evaluated}" instead of pattern`;throw new Error(rt+(typeof evaluated=="function"?", did you forget to call a function?":"."))}return j("[eval] code updated"),P=await _e(P,x),L({miniLocations:It?.miniLocations||[],widgets:It?.widgets||[],activeCode:q,pattern:P,evalError:void 0,schedulerError:void 0,pending:!1}),r?.({code:q,pattern:P,meta:It}),P}catch(P){j(`[eval] error: ${P.message}`,"error"),console.error(P),L({evalError:P,pending:!1}),e?.(P)}},start:ia,stop:oa,pause:ca,setCps:Mt,setPattern:_e,setCode:q=>L({code:q}),toggle:ua,state:C}}const ra=({getTime:t,defaultOutput:e})=>async(n,s,r,o,i)=>{try{(!n.context.onTrigger||!n.context.dominantTrigger)&&await e(n,s,r,o,i),n.context.onTrigger&&await n.context.onTrigger(n,t(),o,i)}catch(u){Gt(u,"getTrigger")}},md=function(t,e={}){const n=document.getElementById("code"),s="background-image:url("+t+");background-size:contain;";n.style=s;const{className:r}=n,o=(a,l)=>{({style:()=>n.style=s+";"+l,className:()=>n.className=l+" "+r})[a]()},i=Object.entries(e).filter(([a,l])=>typeof l=="function");Object.entries(e).filter(([a,l])=>typeof l=="string").forEach(([a,l])=>o(a,l)),i.length},yd=()=>{const t=document.getElementById("code");t&&(t.style="")};j("🌀 @strudel/core loaded 🌀");globalThis._strudelLoaded&&console.warn(`@strudel/core was loaded more than once...
This might happen when you have multiple versions of strudel installed. 
Please check with "npm ls @strudel/core".`);globalThis._strudelLoaded=!0;const _d=Object.freeze(Object.defineProperty({__proto__:null,ClockCollator:Re,Cyclist:sa,Fraction:m,Hap:z,Pattern:d,State:lt,TimeSpan:E,__chooseWith:me,_brandBy:he,_fitslice:Ye,_irand:de,_keyDown:we,_match:tn,_mod:vt,_morph:se,_polymeterListSteps:nn,_retime:Rt,_slices:Lt,accelerate:as,activeLabel:ci,ad:pu,add:bl,adsr:fu,almostAlways:Dh,almostNever:Fh,always:Vh,amp:hs,analyze:Cs,anchor:Ei,and:Jl,apply:mf,applyN:Xe,ar:du,arp:Xa,arpWith:Za,arrange:rl,as:Eu,att:ms,attack:ds,averageArray:Oe,backgroundImage:md,band:Sl,bandf:js,bandq:$s,bank:Bs,base64ToUnicode:We,bbexpr:ar,bbst:fr,beat:$p,begin:Ls,berlin:zh,berlinWith:Zu,binary:mh,binaryN:Fu,bind:ll,binshift:Mc,bite:vf,bjork:ie,blshift:Cl,bor:Bl,bp:Ws,bpa:Dr,bpattack:Fr,bpd:Kr,bpdecay:Ur,bpe:Jr,bpenv:jr,bpf:Js,bpq:Rs,bpr:uo,bprelease:co,bps:no,bpsustain:eo,brak:zf,brand:_h,brandBy:bh,brshift:xl,bxor:Tl,bypass:cp,byteBeatExpression:ur,byteBeatStartTime:lr,calculateSteps:Ga,cat:wt,ccn:_u,ccv:vu,ceil:Fl,ch:hr,channel:Tr,channels:pr,choose:Vu,chooseCycles:Gu,chooseIn:kh,chooseInWith:ye,chooseOut:qh,chooseWith:Nt,chop:Op,chord:xi,chorus:Ts,chunk:Kf,chunkBack:Yf,chunkBackInto:ip,chunkInto:rp,chunkback:tp,chunkbackinto:op,chunkinto:sp,clamp:Ie,cleanupUi:yd,clip:Vc,coarse:Ks,code2hash:$a,color:uu,colour:au,comb:zc,compose:Ca,compress:Kl,compressSpan:Zl,compressor:tc,compressorAttack:sc,compressorKnee:ec,compressorRatio:nc,compressorRelease:rc,compressspan:Xl,constant:xa,contract:an,control:bu,controls:Fp,cosine:eh,cosine2:nh,cpm:yf,cps:Hc,createClock:Iu,createParam:Ot,createParams:lu,crush:Us,ctf:Or,ctlNum:ku,ctranspose:fi,curry:v,curve:Zc,cut:Cr,cutoff:xr,cycleToSeconds:Jt,dec:zs,decay:Os,degrade:Mh,degradeBy:Nh,degradeByWith:Eh,degree:ai,delay:Bo,delayfb:Co,delayfeedback:To,delayspeed:Oo,delaysync:Mo,delayt:Eo,delaytime:zo,deltaSlide:Xc,det:jo,detune:Io,dfb:xo,dict:zi,dictionary:Oi,dist:Yi,distort:Xi,div:kl,djf:So,drawLine:De,drive:sr,drop:on,dry:$o,ds:hu,dt:No,duck:rr,duckattack:cr,duckdepth:or,duckonset:ir,dur:Uc,duration:Qc,e:Gp,early:wf,echo:Lf,echoWith:Jf,echowith:Wf,eish:Yp,end:Fs,enhance:xc,eq:Ml,eqt:Pl,errorLogger:Gt,euclid:Vp,euclidLegato:Kp,euclidLegatoRot:Zp,euclidRot:Up,euclidish:Xp,euclidrot:Qp,evalScope:ea,evaluate:na,every:df,expand:un,expression:lc,extend:cn,fadeInTime:Fo,fadeOutTime:Lo,fadeTime:Ro,fanchor:lo,fast:of,fastChunk:np,fastGap:Yl,fastcat:$,fastchunk:ep,fastgap:tf,fft:xs,filter:pp,filterWhen:hp,firstOf:hf,fit:Pp,flatten:X,floor:Ll,fm:gs,fmattack:_s,fmdecay:ks,fmenv:bs,fmh:ys,fmi:ws,fmrelease:As,fmsustain:qs,fmvelocity:Ss,fmwave:vs,focus:ef,focusSpan:nf,focusspan:sf,fractionalArgs:Oa,frameRate:jc,frames:Jc,freeze:Ac,freq:Do,freqToMidi:Ce,fromBipolar:Hl,fshift:pc,fshiftnote:hc,fshiftphase:dc,ftype:ao,func:$l,gain:fs,gap:pt,gat:si,gate:ni,getControlName:oe,getCurrentKeyboardState:Fe,getEventOffsetMs:ka,getFreq:xe,getFrequency:Ta,getPerformanceTimeSeconds:La,getPlayableNoteValue:Ba,getSoundIndex:Sa,getTime:hd,getTrigger:ra,grow:mp,gt:zl,gte:Nl,harmonic:pi,hash2code:Ra,hbrick:Pc,hcutoff:go,hold:Is,hours:Wc,hp:_o,hpa:Lr,hpattack:Rr,hpd:Qr,hpdecay:Gr,hpe:Ir,hpenv:Pr,hpf:bo,hpq:ko,hpr:io,hprelease:oo,hps:to,hpsustain:Yr,hresonance:vo,hsl:fp,hsla:lp,hurry:cf,id:ut,imag:Cc,inhabit:rd,inhabitmod:id,innerBind:fl,inside:lf,inv:Cf,invert:Tf,ir:Fi,irand:vh,irbegin:Vi,iresponse:Di,irspeed:Hi,isControlName:gn,isNote:Tt,isNoteWithOctave:ga,isPattern:Xt,isaw:Et,isaw2:ue,iter:Vf,iterBack:Gf,iterback:Qf,itri:ih,itri2:ch,jux:jf,juxBy:Pf,juxby:If,kcutoff:wc,keep:wl,keepif:gl,keyAlias:Le,keyDown:Qh,krush:yc,label:ui,lastOf:pf,late:Ke,lbrick:Ic,legato:Gc,leslie:ri,lfo:eu,linger:kf,listRange:kt,lock:Po,logKey:Vt,logger:j,loop:Ds,loopAt:Np,loopAtCps:Ip,loopBegin:Hs,loopEnd:Gs,loopat:Mp,loopatcps:jp,loopb:Vs,loope:Qs,lp:Er,lpa:$r,lpattack:Wr,lpd:Vr,lpdecay:Hr,lpe:Mr,lpenv:Nr,lpf:zr,lpq:Ao,lpr:ro,lprelease:so,lps:Xr,lpsustain:Zr,lrate:oi,lsize:ii,lt:Ol,lte:El,mapArgs:Ut,mask:il,midi2note:Aa,midiToFreq:at,midibend:xu,midichan:mu,midicmd:gu,midimap:yu,midiport:wu,miditouch:Ou,minutes:$c,mod:ql,mode:Pi,morph:Rp,mouseX:fh,mouseY:ah,mousex:lh,mousey:uh,mtranspose:li,mul:vl,n:cs,nanFallback:ze,ne:Il,net:jl,never:Hh,noise:mo,note:us,noteToMidi:_t,nothing:H,nrpnn:qu,nrpv:Au,nudge:mi,numeralArgs:D,objectMap:$e,octave:yi,octaveR:di,octaves:Mi,octer:gc,octersub:bc,octersubsub:_c,off:Of,offset:Ni,often:Rh,or:Wl,orbit:wi,outerBind:pl,outside:ff,overgain:gi,overshape:bi,pace:en,pairs:Pe,palindrome:Mf,pan:_i,panchor:ei,panorient:Ai,panspan:vi,pansplay:ki,panwidth:qi,parseFractional:Me,parseNumeral:Qt,partials:Oc,patt:Vo,pattack:Ho,pcurve:ti,pdec:Qo,pdecay:Go,penv:Yo,perlin:Oh,perlinWith:Ku,ph:gr,phasdp:Br,phaser:br,phasercenter:kr,phaserdepth:Ar,phaserrate:wr,phasersweep:_r,phc:qr,phd:Sr,phs:vr,pick:Xu,pickF:Kh,pickOut:Xh,pickReset:nd,pickRestart:td,pickSqueeze:od,pickmod:Yu,pickmodF:Zh,pickmodOut:Yh,pickmodReset:sd,pickmodRestart:ed,pickmodSqueeze:cd,pipe:Ne,pitchJump:Yc,pitchJumpTime:tu,ply:rf,plyForEach:Hf,plyWith:Df,pm:nl,polyBind:ml,polyTouch:zu,polymeter:xt,polyrhythm:tl,postgain:ps,pow:Al,pr:el,prel:Xo,prelease:Zo,press:Nf,pressBy:Ef,progNum:Su,psus:Ko,psustain:Uo,pure:I,pw:dr,pwrate:mr,pwsweep:yr,rand:G,rand2:gh,randcat:Ah,randrun:Du,range:Vl,range2:Ql,rangex:Gl,rarely:Lh,rate:Si,ratio:Ul,rdim:$i,real:Tc,ref:Jp,register:f,registerControl:c,reify:y,rel:Ps,release:Ms,removeUndefineds:ft,repeatCycles:Uf,repeatTime:nu,repl:dd,resonance:qo,rev:Ze,rfade:Li,rib:ap,ribbon:up,ring:vc,ringdf:qc,ringf:kc,rlp:Ji,room:Ii,roomdim:Wi,roomfade:Ri,roomlp:ji,roomsize:Gi,rotate:Ee,round:Rl,rsize:Ki,run:Lu,s:bn,s_add:kp,s_alt:gp,s_cat:wp,s_contract:Bp,s_expand:Ap,s_extend:Sp,s_polymeter:bp,s_sub:qp,s_taper:_p,s_taperlist:vp,s_tour:Tp,s_zip:Cp,saw:At,saw2:ce,scram:Nc,scramble:wh,scrub:Nu,seconds:Rc,seg:Af,segment:qf,semitone:Ti,seq:Ue,seqPLoop:ol,sequence:Y,sequenceP:He,set:yl,setStringParser:Qa,setTime:Dt,shape:Zi,shrink:fn,shrinklist:ln,shuffle:yh,signal:Q,silence:B,sine:ju,sine2:ae,size:Qi,slice:yn,slide:Bi,slow:uf,slowChunk:Xf,slowcat:nt,slowcatPrime:te,slowchunk:Zf,smear:Ec,sol2note:ja,someCycles:$h,someCyclesBy:Wh,sometimes:Jh,sometimesBy:jh,songPtr:Lc,sound:_n,source:os,sparsity:af,speak:ld,speed:re,splice:Ep,splitAt:Kt,spread:Wo,square:Ju,square2:sh,squeeze:ud,squeezeBind:hl,squiz:cc,src:is,stack:N,stackBy:sl,stackCentre:Qe,stackLeft:Ve,stackRight:Ge,steady:th,stepBind:dl,stepalt:sn,stepcat:W,steps:xp,stepsPerOctave:hi,stretch:oc,striate:zp,stringifyValues:Zt,struct:cl,strudelScope:ta,stut:Ff,stutWith:$f,stutwith:Rf,sub:_l,superimpose:ul,sus:Ns,sustain:Es,sustainpedal:fc,swing:Bf,swingBy:Sf,sysex:Bu,sysexdata:Cu,sysexid:Tu,sz:Ui,take:rn,time:le,timeCat:dn,timecat:yp,toBipolar:Dl,tokenizeNote:Te,tour:pn,tremolo:Zs,tremolodepth:Ys,tremolophase:er,tremoloshape:nr,tremoloskew:tr,tremolosync:Xs,tri:rh,tri2:oh,triode:mc,tsdelay:Bc,uid:Fc,undegrade:Ih,undegradeBy:Ph,unicodeToBase64:Je,uniq:Ja,uniqsort:Wa,uniqsortr:je,unison:Jo,unit:ic,v:ho,val:Dc,valueToMidi:va,velocity:ls,vib:fo,vibmod:yo,vibrato:po,vmod:wo,voice:Ci,vowel:uc,warp:Jn,warpatt:Rn,warpattack:$n,warpdc:Zn,warpdec:Fn,warpdecay:Ln,warpdepth:Un,warpenv:ss,warpmode:Yn,warprate:Qn,warprel:Gn,warprelease:Vn,warpshape:Kn,warpskew:Xn,warpsus:Hn,warpsustain:Dn,warpsync:rs,waveloss:ac,wavetablePhaseRand:ns,wavetablePosition:kn,wavetableWarp:Wn,wavetableWarpMode:ts,wchoose:Bh,wchooseCycles:Uu,when:xf,whenKey:Gh,withValue:al,within:dp,wrandcat:Th,wt:vn,wtatt:Sn,wtattack:An,wtdc:In,wtdec:Tn,wtdecay:Bn,wtdepth:Mn,wtenv:qn,wtphaserand:es,wtrate:En,wtrel:zn,wtrelease:On,wtshape:Pn,wtskew:jn,wtsus:xn,wtsustain:Cn,wtsync:Nn,xfade:wn,xsdelay:Sc,zcrush:ou,zdelay:iu,zip:hn,zipWith:Ct,zmod:ru,znoise:su,zoom:gf,zoomArc:bf,zoomarc:_f,zrand:Kc,zzfx:cu},Symbol.toStringTag,{value:"Module"}));export{Ra as $,$a as A,Tt as B,Re as C,lu as D,I as E,Ce as F,at as G,Sa as H,Ba as I,_d as J,Ie as K,N as L,m as M,dn as N,it as O,d as P,Y as Q,$ as R,ye as S,G as T,Qa as U,c as V,dd as W,La as X,va as Y,ea as Z,vt as _,Zi as a,Q as b,ka as c,B as d,ta as e,W as f,hd as g,of as h,uf as i,cn as j,un as k,Nh as l,Aa as m,_t as n,kh as o,en as p,Ue as q,y as r,re as s,j as t,Xt as u,oe as v,Jp as w,f as x,Qt as y,Ta as z};
